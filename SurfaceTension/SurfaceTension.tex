\documentclass[a4paper,11pt]{article}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath,amsfonts,amsthm,amssymb,mathtools,dsfont}
\usepackage{a4wide}
\usepackage{hyperref}
\usepackage{tikz}
\usepackage{parskip} 

\renewcommand{\to}[1]{\text{\boldmath $#1$}} % Bold, cursive
\newcommand{\ts}[1]{\text{\boldmath $\mathrm{#1}$}} % Bold, straigt
\newcommand{\td}[1]{\text{\boldmath $\mathcal{#1}$}} % Bold, 
\newcommand{\tf}[1]{\text{\boldmath $\mathsf{#1}$}} % Bold, sans-serif
\newcommand{\uv}[1]{\mathds{#1}}
\newcommand{\um}[1]{\mathds{#1}}
\newcommand{\intd}[1]{\mathrm{d}#1}
\newcommand{\pderiv}[2]{\frac{\partial#1}{\partial#2}}
\newcommand{\dderiv}[2]{\frac{\mathrm{d}#1}{\mathrm{d}#2}}
\newcommand{\norm}[1]{\left\lVert{#1}\right\rVert}
\newcommand{\T}{\mathrm{T}}
\newcommand{\defeq}{:=}
\newcommand{\element}{\mathrm{e}}
\newcommand{\linear}{\mathrm{lin}}
\DeclareMathOperator{\diff}{D}

\begin{document}
\section{Surface tension in FEA}
This document derives expressions necessary to calculate the load vector in FE analysis for isotropic surface tension. First rewriting the curvature in order to avoid the second derivative.
\begin{align}
 \int_\Omega 2 H \to w\cdot \to n\intd A = \int_{\partial\Omega} \to w\cdot\to m\intd S - \int_\Omega \to \nabla_s \cdot \to w \intd A
 \label{eq:curvature}
\end{align}
where both integrals will need to be calculated. The difficult part comes from the surface divergence,
\begin{align}
 \to \nabla_s \defeq \left(\ts I - \to n\otimes\to n \right)\cdot \to \nabla
\end{align}
which can be complicated to compute. The boundary term over $\partial\Omega$ is where the free surface ends. It could be on side of an finite element surface, possibly several.

\section{Extruded 2D}
For brevity, the notation $(\bullet)' = \pderiv{\bullet}{\xi}$ is used.

The surface $\Omega$ is the extruded 2D line shown in figure \ref{fig:extruded}.
\begin{figure}[htpb]
 \centering
 \begin{tikzpicture}
  \draw[thick] (0,0) to[out=0,in=250] (1,1) coordinate[near start] (m) node[at start,left] {$A$} node[at end,right] {$B$};
  \draw[->] (0,0.2) to[out=0,in=250] (0.8,1) node[at end,left] {$s$};
  \draw[|->] (m) -- +(30:0.7) node[at end,right] {$\to e_s[\xi]$};
  \draw[fill,black] (0,0) circle (0.05) (1,1) circle (0.05);
 \end{tikzpicture}
 \caption{Geometry and coordinate system for 2D (and axisymmetric)}
 \label{fig:extruded}
\end{figure}

The geometry is parameterized as
\begin{align}
 \to x &= \sum_{i=1}^n N_i[\xi]\to x_i
  = \um N \cdot \uv X
  = \underbrace{\begin{bmatrix}N_1 & 0 & \cdots\\ 0 & N_1 & \cdots \end{bmatrix}}_{2\times 2n}\cdot \underbrace{\begin{bmatrix}x_1\\y_1\\x_2\\y_2\\ \vdots\end{bmatrix}}_{2n\times 1}
\end{align}
so the divergence and integral can be rewritten by obtaining
\begin{gather}
 J \defeq \dderiv{s}{\xi} = \norm{\to x'}\\
 \to e_s \defeq \to x' J^{-1}\\
 \intd A = t \intd s = t J \intd \xi     \label{eq:intdA_2d}\\
 \to \nabla_s = \pderiv{}{s}\to e_s = \pderiv{}{\xi}\to e_s J    \label{eq:nabla_s_2d}
\end{gather}
and for the tangent the following derivations are also usefull
\begin{align}
 \pderiv{\to x'}{\to x_i} &= N_i' \ts I & \pderiv{\to x'}{\uv X} &= \um N'\\
 \pderiv{J}{\to x_i} &= J^{-1} \to x'\cdot \pderiv{\to x'}{\to x_i} = J^{-1} \to x'N_i'  & \pderiv{J}{\uv X} &= J^{-1} \to x'\cdot \um N' \\
 \pderiv{\to e_s}{\to x_i} &= (\ts I - \to x'\otimes\to x' J^{-2})N_i' J^{-1} &  \pderiv{\to e_s}{\uv X} &= (\ts I - \to x'\otimes \to x'J^{-2})\cdot \um N' J^{-1}
\end{align}

Plugging \eqref{eq:intdA_2d} and \eqref{eq:nabla_s_2d} into the integral in \eqref{eq:curvature}
\begin{align}
 \int_\Omega\to \nabla_s\cdot\to w\intd A &= t \int_a^b \to w'\cdot \to e_s \intd\xi\\
\end{align}
and its tangent
\begin{align}
 \int_\Omega\to \nabla_s\cdot\to w\intd A \otimes \pderiv{}{\uv X}
 =&t \int_a^b \left(\to w'\cdot \to e_s\right)\otimes \pderiv{}{\uv X}  \intd\xi\\
 =&t \int_a^b \to w'\cdot \pderiv{\to e_s}{\uv X} \intd\xi\\
 =&t \int_a^b \to w'\cdot \left(\ts I-\to x'\otimes\to x' J^{-2}\right)\cdot \um N' J^{-1} \intd\xi
\end{align}

The boundary term is trivial
\begin{align}
 &\int_{\partial\Omega} \to w\cdot \to m\intd S = \to w \cdot\to m t = - \to w \cdot \to e_s t
\end{align}
and its tangent (with edge at $\to x_1$)
\begin{align}
 \int_{\partial\Omega} \to w\cdot \to m\intd S\otimes \pderiv{}{\uv X} &= t \to w\cdot\pderiv{\to m}{\uv X}\\
 &= -t \to w\cdot\pderiv{\to e_s}{\uv X}\\
 &= -t \to w\cdot \left(\ts I-\to x'\otimes\to x' J^{-2}\right)\cdot \um N' J^{-1}
\end{align}

The load vector becomes
\begin{gather}
 \to w = \um N\cdot\uv C\\
 \uv F^\element = \gamma t \int_a^b {\um N^\element}'^\T\cdot \to e_s \intd\xi\\
 \um K^\element = \gamma t \int_a^b {\um N^\element}'^\T\cdot \left(\ts I-\to x'\otimes\to x' J^{-2}\right)\cdot{\um N^\element}' J^{-1} \intd\xi
\end{gather}
and the boundary term (at $\to x_1$)
\begin{gather}
 \uv F^\element = \gamma t \begin{bmatrix}m_x\\m_y\\0\\\vdots\end{bmatrix} = - \gamma t \begin{bmatrix}e_{s,x}\\e_{s,y}\\0\\\vdots\end{bmatrix}\\
 \um K^\element = -\gamma t {\um N^\element}^\T \cdot (\ts I - \to x'\otimes \to x' J^{-2})\cdot {\um N^\element}' J^{-1}
\end{gather}
and the special case of linear elements
\begin{gather}
 \uv F^\element_\linear = \gamma t L^{-1} \begin{bmatrix}x_2-x_1\\y_2-y_1\\x_1-x_2\\y_1-y_2\end{bmatrix}\\
 \um K^\element_\linear = \gamma t L^{-1}\left(
	\begin{bmatrix}-1&0&1&0\\0&-1&0&1\\1&0&-1&0\\0&1&0&-1\end{bmatrix}+
	L^{-2}\begin{bmatrix}x_2-x_1\\y_2-y_1\\x_1-x_2\\y_1-y_2\end{bmatrix}\cdot\begin{bmatrix}x_2-x_1\\y_2-y_1\\x_1-x_2\\y_1-y_2\end{bmatrix}^\T
  \right)
\end{gather}
and for the boundary
\begin{gather}
 \uv F^\element_\linear = -\gamma t L^{-1} \begin{bmatrix}x_2-x_1\\y_2-y_1\\0\\0\end{bmatrix}\\
 \um K^\element_\linear = -\gamma t L^{-1} \left(\begin{bmatrix}-1&0&1&0\\0&-1&0&1\\0&0&0&0\\0&0&0&0\end{bmatrix} + L^{-2} \begin{bmatrix}x_2-x_1\\y_2-y_1\\0\\0\end{bmatrix}\cdot\begin{bmatrix}x_2-x_1\\y_2-y_1\\x_1-x_2\\y_2-y_1\end{bmatrix}^\T\right)\\
\end{gather}

\section{Axisymmetric}
For brevity, the notation $(\bullet)' = \pderiv{\bullet}{\xi}$ or $(\bullet)' = \pderiv{\bullet}{\theta}$ is used for $f[\xi]$ and $f[\theta]$ respectively.

This part was more complicated than initially estimated.
I have consistently decomposed variables into $\ts Q$ to make this managable and also analytically calculating the integral over $\theta$.

With cylindrical coordinates $\to r = r\to e_r + z \to e_z$.
\begin{align}
 \to r &= \sum_i N_i[\xi]\to r_i = \um N\cdot \uv R\\
 x &= \cos[\theta] r\\
 y &= \sin[\theta] r\\
 z &= z\\
 \ts Q &= \begin{bmatrix}\cos[\theta] & 0\\ \sin[\theta] & 0\\ 0 & 1\end{bmatrix}\\
 \to x &= \ts Q[\theta] \cdot \to r[\xi]\\
 \to w &= \ts Q[\theta] \cdot \to v[\xi]\\
 \to m &= \ts Q[\theta] \cdot \to t[\xi]
\end{align}

Since we have a convenient orthogonality, we can treat $\xi$ and $\theta$ seperarely.
\begin{align}
 J_\xi &= \norm{\pderiv{\to x}{\xi}} = \norm{\ts Q \cdot \to r'} = \norm{\to r'}\\
 J_\theta &= \norm{\pderiv{\to x}{\theta}} = \norm{\ts Q' \cdot \to r} = r \\
 \intd A &= J_\xi J_\theta \intd \xi \intd \theta \\
 \to\nabla_s &= J_\xi^{-2} \pderiv{\to x}{\xi}\pderiv{}{\xi} + J_\theta^{-2} \pderiv{\to x}{\theta}\pderiv{}{\theta}
\end{align}
and for the tangent the following derivations are also usefull
\begin{align}
 \to e_s &\defeq \to r' J_\xi^{-1} \\
 \pderiv{\to r'}{\to r_i} &= N_i' \ts I
	& \pderiv{\to r'}{\uv R} &= \um N'\\
 \pderiv{J_\xi}{\to r_i} &= J_\xi^{-1} \to r'\cdot \pderiv{\to r'}{\to r_i} = J_\xi^{-1} \to r'N_i'
	& \pderiv{J_\xi}{\uv R} &= J_\xi^{-1} \to r'\cdot \um N' \\
 \pderiv{\to e_s}{\to r_i} &= (\ts I - \to r'\otimes\to r' J_\xi^{-2})N_i' J_\xi^{-1}
	& \pderiv{\to e_s}{\uv R} &= (\ts I - \to r'\otimes \to r'J_\xi^{-2})\cdot \um N' J_\xi^{-1}
\end{align}

Plugging this into \eqref{eq:curvature} to obtain
\begin{align}
 &\int_\Omega\to \nabla_s\cdot\to w\intd A\\
=&\int_a^b\int_0^{2\pi}\left( J_\xi^{-2} \pderiv{\to x}{\xi}\cdot\pderiv{\to w}{\xi} +
                              J_\theta^{-2} \pderiv{\to x}{\theta}\cdot\pderiv{\to w}{\theta}
  \right) J_\xi J_\theta \intd \theta \intd \xi\\
=&\int_a^b\int_0^{2\pi}\left(
	  J_\xi^{-2} (\ts Q^\T\cdot\ts Q):(\to r'\otimes \to v') +
	  J_\theta^{-2} ({\ts Q'}^\T\cdot\ts Q'):(\to r\otimes\to v)
  \right) J_\xi J_\theta \intd \theta \intd \xi\\
=&\int_a^b\int_0^{2\pi}\left(
	  J_\xi^{-2} \ts I :(\to r'\otimes \to v') +
	  J_\theta^{-2} \begin{bmatrix}1&0\\0&0\end{bmatrix}:(\to r \otimes \to v)
  \right) J_\xi J_\theta \intd \theta \intd \xi\\
=&2\pi\int_a^b\left( \to v'\cdot \to r' J_\xi^{-1} r + \cdot \to v\cdot \begin{bmatrix}1\\0\end{bmatrix} J_\xi \right) \intd \xi\\
=&2\pi\int_a^b\left( \to v' \cdot \to e_s r + \to v \cdot \begin{bmatrix}1\\0\end{bmatrix} J_\xi \right) \intd \xi
\end{align}
and its tangent
\begin{align}
 &\int_\Omega\to \nabla_s\cdot\to w\intd A \otimes \pderiv{}{\uv R} \\
 =& 2\pi \int_a^b \left(
	\to v' \cdot \to e_s r + \to v\cdot \begin{bmatrix}1\\0\end{bmatrix} J_\xi
	\right)\otimes\pderiv{}{\uv R}\intd\xi\\
  =& 2\pi \int_a^b \left(
	\to v' \cdot \to e_s \otimes \pderiv{r}{\uv R} + \to v'\cdot \pderiv{\to e_s}{\uv R} r + \to v\cdot \begin{bmatrix}1\\0\end{bmatrix}\otimes\pderiv{J_\xi}{\uv R}
	\right)\intd\xi\\
  =& 2\pi \int_a^b \bigg(
	\to v' \cdot \to e_s \otimes\left(\begin{bmatrix}1&0\end{bmatrix}\cdot \um N\right) +
	\to v'\cdot (\ts I - \to r'\otimes \to r'J_\xi^{-2})\cdot \um N' J_\xi^{-1} r
	+\to v\cdot \begin{bmatrix}1\\0\end{bmatrix}\otimes (\to r'\cdot \um N')J_\xi^{-1}
	\bigg)\intd\xi
\end{align}
%J_\xi^{-1} \to r'\cdot \um N'
The boundary term is computed as
\begin{align}
 \int_{\partial\Omega} \to w\cdot\to m\intd S &= \int_0^{2\pi} (\ts Q^\T\cdot \ts Q):(\to v\cdot\to t) r \intd \theta\\
  &= 2\pi r \to v \cdot \to t
\end{align}
and its tangent (with edge at $\to r_1$)
\begin{align}
 \int_{\partial\Omega} \to w\cdot\to m\intd S \otimes \pderiv{}{\uv R} &= 2\pi (r \to v \cdot \to t)\otimes \pderiv{}{\uv R}\\
  &= 2 \pi \to v\cdot\left(\to t\otimes\pderiv{r}{\uv R} + r \pderiv{\to t}{\uv R}\right)\\
  &= -2 \pi \to v\cdot\left(\to e_s\otimes\left(\begin{bmatrix}1&0\end{bmatrix}\cdot\um N\right) + r \left(\ts I-\to r'\otimes\to r' J_\xi^{-2}\right)\cdot \um N' J_\xi^{-1}\right)
\end{align}

The load vector for an element is
\begin{gather}
 \to v = \um{N}\cdot\um{C}\\
 \uv F^\element = 2\pi \gamma \int_a^b \left(r\to e_s\cdot{\um N^\element}'^\T + J_\xi{\um N^\element}^\T\cdot\begin{bmatrix}1\\0\end{bmatrix}\right) \intd\xi\\
 \um K^\element = TODO
\end{gather}
\begin{gather}
 \uv F^\element = 2\pi \gamma r \begin{bmatrix}t_1\\t_2\\0\\\vdots\end{bmatrix}\\
 \um K^\element = TODO
\end{gather}

and the special case of linear elements
\begin{gather}
 \uv F^\element_\linear = \pi \gamma \left(\frac{r_1+r_2}{L}\begin{bmatrix}r_1-r_2\\z_1-z_2\\r_2-r_1\\z_2-z_1\end{bmatrix} + L\begin{bmatrix}1\\0\\1\\0\end{bmatrix}\right)\\
 \um K^\element_\linear = TODO
\end{gather}
\begin{gather}
 \uv F^\element_\linear = 2\pi \gamma r_1 L^{-1} \begin{bmatrix}r_1-r_2\\z_1-z_2\\0\\0\end{bmatrix}\\
 \um K^\element_\linear = TODO
\end{gather}


\section{General 3D}

Introducing another parameter $\zeta$ in order to obtain a nice mapping.
\begin{align}
 \to x[\xi,\eta,\zeta] &= (1-\zeta)\sum_i N_i[\xi,\eta]\to x_i = (1-\zeta) \um N \cdot \uv X\\
  &= (1-\zeta) \begin{bmatrix}N_1 & 0 & 0 & N_2 & \cdots\\0&N_1&0&0&\cdots\\0&0&N_1&0&\cdots\end{bmatrix}\cdot\begin{bmatrix}x_1\\y_1\\z_1\\x_2\\\vdots\end{bmatrix}
\end{align}

\begin{gather}
 J \defeq \norm{\pderiv{\to x}{\xi} \times  \pderiv{\to x}{\eta}}\\
 \to n = \pderiv{\to x}{\xi} \times \pderiv{\to x}{\eta} J^{-1}\\
 \begin{bmatrix}\intd x\\ \intd y\\ \intd z\end{bmatrix} =
  \underbrace{\begin{bmatrix}\pderiv{x}{\xi} & \pderiv{x}{\eta} & \pderiv{x}{\zeta}\\
	  \pderiv{y}{\xi} & \pderiv{y}{\eta} & \pderiv{y}{\zeta}\\
	  \pderiv{z}{\xi} & \pderiv{z}{\eta} & \pderiv{z}{\zeta} \end{bmatrix}}_{\ts J}
  \cdot \begin{bmatrix}\intd \xi \\ \intd \eta \\ \intd \zeta\end{bmatrix}\\
 \to\nabla = \ts J^{-\T}\cdot\to\nabla_\xi\\
 \intd A = J \intd \xi \intd \eta 
\end{gather}

and we obtain
\begin{align}
 &\iint_\Omega\to \nabla_s\cdot\to w\intd A\\
=&\iint_\omega(\ts I-\to n\otimes\to n):(\to w\otimes \ts J^{-\T}\cdot\to\nabla_\xi)J\intd\xi\intd\eta\big|_{\zeta=1}\\
=&\iint_\omega(\ts I-\to n\otimes\to n):\left((\to w\otimes\to\nabla_\xi) \cdot\ts J^{-1}\right)J\intd\xi\intd\eta\big|_{\zeta=0}
%=&\iint_\omega((\ts I-\to n\otimes\to n)\cdot\ts J^{-\T}):(\to w\otimes\to\nabla_\xi)J\intd\xi\intd\eta\big|_{\zeta=0}\\
%=&\iint_\omega(\to w\otimes\to\nabla_\xi):((\ts I-\to n\otimes\to n)\cdot\ts J^{-\T})J\intd\xi\intd\eta\big|_{\zeta=0}
\end{align}

And given an edge along $\xi$;
\begin{align}
 &\int_{\partial\Omega}\to w\cdot\to m\intd S\\
=&\int_{\partial\omega}\to w\cdot\to m\norm{\pderiv{\to x}{\xi}}\intd \xi\\
 \hat{\to n} &= \to e_\xi \times \to e_\eta\\
 \hat{\to m} &= \to e_\xi \times \hat{\to n} = \to e_\xi\times (\to e_\xi \times \to e_\eta)\\
 \to m &= \hat{\to m}\norm{\to m}^{-1}
\end{align}

It becomes a bit tricky to express the load vector nicely due to the appearance of a third order tensor, it will need to be reshaped.
After some rewriting the expression becomes
\begin{align}
 \hat{\uv N}^\element &= \begin{bmatrix} N_1^\element\\ N_2^\element\\ \vdots\end{bmatrix}\\
 \hat{\um B}^\element &= \ts J^{-\T}\cdot(\to\nabla_\xi\cdot(\hat{\uv N}^\element)^\T)\\
 \hat{\um F}^\element &= \iint_\omega(\ts I-\to n \cdot \to n^\T)\cdot \hat{\um B}^\element J\intd\xi\intd\eta\big|_{\zeta=0}\\
 \uv F^\element &= \begin{bmatrix}\hat{\uv F}^\element_{1:}\\\hat{\uv F}^\element_{2:}\\\vdots\end{bmatrix}
\end{align}




\section{General 3D alternative method}
\begin{align}
 \to x[\xi,\eta] = \sum_i N_i[\xi,\eta]\to x_i
\end{align}

\begin{gather}
 J \defeq \norm{\pderiv{\to x}{\xi} \times  \pderiv{\to x}{\eta}}\\
 \to n = \pderiv{\to x}{\xi} \times \pderiv{\to x}{\eta} J^{-1}\\
 \to e_s = \pderiv{\to x}{\xi}\norm{\pderiv{\to x}{\xi}}^{-1}\\
 \to e_t = -\to e_s\times \to n\\
 \begin{bmatrix}\intd x\\ \intd y\\ \intd z\end{bmatrix} =
  \underbrace{\begin{bmatrix}\pderiv{\to x}{\xi} & \pderiv{\to x}{\eta}
  \end{bmatrix}}_{\ts J''}
  \cdot \begin{bmatrix}\intd \xi \\ \intd \eta\end{bmatrix}\\
 \begin{bmatrix}\intd s\\ \intd t\end{bmatrix} =
  \underbrace{\begin{bmatrix} \to e_s^\T \\ \to e_t^\T
  \end{bmatrix}}_{\ts J'}
  \cdot \begin{bmatrix}\intd x \\ \intd y \\ \intd z\end{bmatrix}\\
 \intd A = J \intd \xi \intd \eta
\end{gather}

\begin{align}
 \to\nabla_s\cdot\to w &= \to\nabla_{st}\cdot\to w_{st} \\
 &= (\to w_{st}\otimes\to\nabla_{st}):\ts I \\
 &= \left(((\ts J'\cdot \to w) \otimes \to\nabla_{\xi\eta})\cdot \left(\ts J'\cdot\ts J''\right)^{-1}\right): \ts I\\
 &= \left((\to w\cdot (\ts J'^\T \otimes \to\nabla_{\xi\eta}) +\ts J'\cdot(\to w\otimes\to\nabla_{\xi\eta}) )\cdot \left(\ts J'\cdot\ts J''\right)^{-1}\right): \ts I
\end{align}
The gradient $\ts J'^\T \otimes\to\nabla_{\xi\eta}$ is bothersome.
\begin{align}
 \to e_s \otimes \to\nabla_{\xi\eta} = \text{ugh...}
\end{align}

Considering the special case of linear surfaces;
\begin{align}
  \to\nabla_s\cdot\to w &= \left(\ts J'\cdot(\to w\otimes\to\nabla_{\xi\eta})\cdot \left(\ts J'\cdot\ts J''\right)^{-1}\right): \ts I
\end{align}

\begin{align}
 &\iint_\Omega\to \nabla_s\cdot\to w\intd A\\
=&\iint_\omega \ts I:\left(\ts J'\cdot(\to w\otimes\to\nabla_{\xi\eta})\cdot \left(\ts J'\cdot\ts J''\right)^{-1}\right)J\intd\xi\intd\eta
\end{align}

\end{document}
