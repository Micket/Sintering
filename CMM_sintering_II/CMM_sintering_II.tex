\RequirePackage[l2tabu,orthodox]{nag} % This package helps prevent you from doing things wrong.

\documentclass[10pt,a4paper,fleqn]{article}

\usepackage{ifluatex}
\ifluatex
  \usepackage{fontspec}
  %\setmainfont[Ligatures=TeX]{xits}
  %\setmathfont[math-style=ISO]{xits-math}
  \setmainfont[Ligatures=TeX]{Latin Modern Roman}
  \fontspec[SmallCapsFeatures={Letters=SmallCaps}]{Latin Modern Roman}
\else
  \usepackage[utf8]{inputenc}
\fi

\usepackage[margin=2cm,includefoot]{geometry}
\usepackage{amsmath, amssymb, mathtools}
\usepackage{graphicx, subfig, float, grffile}
\usepackage{algorithm,algorithmic}
\usepackage{microtype}
\usepackage{todonotes}
\usepackage{siunitx}
\usepackage{tikz}
\usepackage{pgfplots}

\usepackage[firstinits=true, style=numeric, url=false, isbn=false, hyperref=true,backend=biber]{biblatex}
\def\bibfont{\footnotesize}

\usepackage[colorlinks=true,linkcolor=black,urlcolor=black,citecolor=black,filecolor=black]{hyperref}
%\usepackage{cleveref}

\linespread{1.3}
\usepackage{contmech}
\ifluatex
  \usepackage{unicode-math}
  \setmathfont[math-style=ISO]{lmmath-regular.otf}
  \renewcommand{\ta}[1]{\mathbfit{#1}}
  \renewcommand{\ts}[1]{\mathbfit{#1}}
  \renewcommand{\td}[1]{\mathbfcal{#1}}
  \renewcommand{\tf}[1]{\mathbfsfup{#1}}
  \renewcommand{\Box}{\mdlgwhtsquare}
  \renewcommand{\leadsto}{\rightsquigarrow}
\fi
% \renewcommand{\vec}[1]{\mathds{#1}}
% \renewcommand{\mat}[1]{\mathds{#1}}

\captionsetup[subfigure]{textfont=it}
\captionsetup[figure]{textfont=it}
\newcommand{\figref}[1]{Figure~\ref{#1}}

\renewcommand{\topfraction}{1.0}	% 99% of page top can be a float
\renewcommand{\bottomfraction}{1.0}	% 99% of page bottom can be a float
\renewcommand{\textfraction}{0.0}	% only 1% of page must to be the text
\renewcommand{\floatpagefraction}{1.0} % 99% of whole page can be a float
\setcounter{totalnumber}{100} %maximum floating objects on one page

% More specialized commands;
\DeclarePairedDelimiter{\homogenized}{\langle}{\rangle}
\newcommand{\pore}{\mathrm{pore}}
\newcommand{\particle}{\mathrm{part}}
\newcommand{\free}{\mathrm{f}}
\newcommand{\prescribed}{\mathrm{p}}
\newcommand{\moving}{\mathrm{mov}}
\newcommand{\segment}{\mathrm{segm}}
\newcommand{\corner}{\mathrm{corn}}
\newcommand{\contact}{\mathrm{cont}}
\newcommand{\external}{\mathrm{ext}}
\newcommand{\internal}{\mathrm{int}}
\newcommand{\surf}{\mathrm{s}}
\newcommand{\mesh}{\mathcal{M}}
\newcommand{\on}{\quad\text{ on }}
\newcommand{\NDIM}{n_\mathrm{dim}}
\newcommand{\tang}{\mathrm{T}}
\newcommand{\curve}{\mathcal{C}}

\newcommand{\ded}{\mathrm{d}}
\newcommand{\dep}{\mathrm{p}}

%\newcommand{\prescribed}{\mathrm{p}}

\newcommand{\derv}{\mathrm{v}}

%\newcommand{\on}{\mid}
%\newcommand{\surfdiff}{\hat{\ts\nabla}}
%\newcommand{\at}[2]{\left.#1\right|_{#2}}

\bibliography{Boundary_representation,Boundary_potentials,Multiscale,FEM_Software,Sintering,Mesh,OhmanPublications}

\begin{document}
\title{FE$^2$ for Liquid-Phase Sintering with Seamless Transition from Macroscopic Compressibility to Incompressibility}

\author{
Mikael Öhman, Fredrik Larsson and Kenneth Runesson\\
Department of Applied Mechanics \\
Chalmers University of Technology}

\maketitle

\begin{abstract}
\noindent In a previous paper, \textsc{Öhman et al.} \cite{Ohman2011a}, liquid phase sintering of particle agglomerates was modeled on the mesoscale as the viscous deformation of particle-particle contact, whereby the single driving force is the surface tension on the particle/pore interface. A FE\textsuperscript{2}-strategy was outlined; however, the variational setting is applicable only under the restriction of non-vanishing macroscopic porosity (corresponding to a not fully dense end-product). The present paper generalizes this situation such that it allows for the transition to zero porosity, which is accomplished by introducing a mixed variational format of the macroscale problem. This has consequences also for the formulation of the RVE-problem, that is complemented with an extra constraint equation regarding the prolongation of the volumetric part of the macroscopic rate-of-deformation.
Still, Dirichlet boundary conditions on the subscale velocity are adopted.
The numerical example shows the sintering of a single RVE, which is sheared beyond the point where the porosity vanishes while subjected to zero macroscopic pressure.

\end{abstract}

\section{Introduction}

Powder metallurgy is a versatile technology for the manufacturing of components to (near) net-shape with high product quality. For a hardmetal (such as WC-Co) cold compaction of the powder to a ``green body'' is followed by liquid-phase sintering from the subsequent heating. This means that the binder metal Co is heated to melt in order to obtain sufficient mobility via capillary action, i.e. via surface traction, stemming from stored surface energy. The resulting flow causes gradual filling of the pore space and brings about a macroscopic shrinkage of the particle compact until a completely dense state is obtained, at least ideally. To model and quantatively simulate the sintering process is a challenging task. The goal is to (i) estimate the final resulting quality (i.e. in terms of porosity) and (ii) to predict the final net shape and size of the sintered component.

A wealth of literature has been devoted to the modeling and simulation of the sintering process. From a mesoscale viewpoint, a classical approach is to consider socalled ``unit problems'', whereby the constitutive modeling is based on diffusion and, most importantly, flow models. Among the early attempts to numerically simulate the surface-tension driven reshaping of contacting particles are those by \cite{JagDaw1988a,JagDaw1988b}, \cite{Vorst1993}.
In a series of papers, \cite{ZhoDer1998,ZhoDer2001} emphasize efficient finite element algorithms to trace the complex 3-dimensional flow of multi-particle interaction. The main challenges  are the complex subscale geometry and the moving free boundary giving rise to very large deformations and severe topology changes. Recent developments of free-boundary tracing FE-strategies for large deformations (without severe topological changes) are discussed by \cite{DetPer2006}, \cite{SakPer2006a}, \cite{SakPer2006b}.
All the mentioned work consider surface tension effects in fluids. A recent extension to include surface tension in the context of solid modeling, where anisotropic surface energy may be present, is due to \cite{JavSte2009:2d,JavSte2010:3d}.

Attempts have also been made in the literature to use macroscopic models based on nonlinear viscoelasticity and viscoplasticity. In such models the densification process is driven by the ``sintering stress'', which is the macroscale manifestation of the stored surface energy. From a thermodynamical viewpoint, it is the dissipative stress that is conjugated to the current macroscale porosity. e.g. \cite{ReiOak1990}, \cite{MahRun2000}. Among the literature on macroscale modeling, we mention \cite{Svoetal1996}, \cite{XuMeh1997} and \cite{Luetal2001:porosity}.


In a previous paper, \textsc{Öhman et al.} \cite{Ohman2011a}, liquid phase sintering of particle agglomerates was modeled on the mesoscale as the viscous deformation of particle-particle contact. A FE\textsuperscript{2}-strategy was outlined; however, the variational setting was applicable only under the restriction of non-vanishing macroscopic porosity (corresponding to a not fully dense end-product). The present paper generalizes this situation such that it allows for the transition to zero porosity, which is accomplished by introducing a mixed variational format of the macroscale problem. We (still) assume that the particles are homogeneous and deform as a viscous fluid with sufficiently high viscosity to motivate the neglect of all acceleration terms. Moreover, the simplifying assumption is introduced that the flow properties are unaffected by temperature changes, i.e the sintering process is only modeled during the fully heated part of the process.

The paper is structured as follows:
The various features of subscale modeling (surface tension, particle arrangements within the RVE, etc.) are briefly summarized in Section \ref{sec:subscale}. This is followed in Section \ref{sec:macro} by the description of the macroscale problem, whereas the RVE-problem with Dirichlet boundary conditions is presented in Section \ref{sec:rve_problem}. Numerical examples, based on a single RVE as well as FE\textsuperscript{2}-computations, are presented in Section \ref{sec:examples}. Conclusions and an outlook to future developments are given in the final section.


\section{Subscale modeling}\label{sec:subscale}

\subsection{Preliminaries}

We consider a sintering body with current macroscale configuration $\Omega(t)$ in space for any given time $t\geq 0$. The boundary of $\Omega(t)$ is denoted $\Gamma^\external(t)$, and we adopt standard Dirichlet and Neumann boundary conditions on the (external) boundary parts $\Gamma^\external_\Dirichlet$ and $\Gamma^\external_\Neumann$, respectively. In particular, prescribed tractions, $\bar{\ta t}_\prescribed$, act on $\Gamma^\external_\Neumann$.  Our aim is to exploit the concept of computational homogenization in order to determine the unknown $\Omega(t)$ and certain mechanical fields on $\Omega(t)$, such as the current macroscale velocity field, $\bar{\ts v}$, the macroscale true stress field, $\bar{\ts\sigma}$, and the macroscale porosity field, $\phi$. We note that the initial configuration $\Omega(0)$ represents the so called ``green body'', obtained after cold compaction and characterized by the inhomogeneous (macroscopic) porosity $\phi_0$. In the case of ``free sintering'', i.e. sintering without any external loading, it is clear that $\bar{\ts\sigma}$ represents the macroscopic residual stresses at every instant in time.

Subsequently, we shall adopt modeling on the subscale in terms of an Eulerian description of the motion, which means that it will be possible to trace the development of the current macroscale configuration $\Omega(t)$ by computing the macroscale velocity field $\bar{\ta v}(\bar{\ta x},t)$ for $(\bar{\ta x},t)\in\Omega\times(0,T)$. It is then assumed, for the mesoscale representation, that the ``solid particle skeleton'' consists of a contiguous assembly of particles that are in contact, thereby occupying the multiply connected domain $\Omega^\particle=\cup_j\Omega^\particle_j$, as shown in Figure \figref{fig:micro}. We also identify smooth pore surfaces $\Gamma^\pore=\cup_i\Gamma^\pore_i$ and smooth contact surfaces $\Gamma^\contact=\cup_j\Gamma^\contact_j$.

In a 3D representation of the microstructure the assembly of sintering particles create an open pore system (at least initially). With reasonable accuracy one may then assume that the pore surfaces are ``free'' surfaces, i.e. the pore gas does not impose any resistance on the motion. The situation is, of course, different in the (physically unrealistic) case of a 2D representation of the microstructure. The pore system will then inevitably be closed from the start of the sintering process, and the ``trapped'' gas may impose a pressure on the pore surfaces. In any case the pertinent surfaces associated with surface tension are particle/pore and particle/particle (contact) surfaces, as indicated in \figref{fig:micro}.
%-------------------------------------------------------------------------
\begin{figure}[th!]
    \centering
    \input{figures/sintering_rve.tikz}
    \caption{Microstructure of porous particulate material with sintering particles in contact. The sintering body is subjected to Dirichlet and Neumann boundary conditions on the external boundary.}
    \label{fig:micro}
\end{figure}
%-----------------------------------------------------------------------------


\subsection{Surface tension}

The ``surface tension'' along particle/particle and particle/pore interfaces (the latter denoted pore boundaries) is considered to be the sole ``driving force'' of the sintering process, and it is defined in terms of a ``surface tension force'' acting in the tangent plane of the surface. In the simplest (and most common) case of isotropic surface tension, this traction is characterized by the constant surface-specific surface energy $\gamma_\surf$ in the current configuration as the single material parameter. Although we adopt this simplified model below in the numerical results, it is possible to consider the more general situation of anisotropic ``surface stress'' that may also depend on the surface deformation via a suitable constitutive assumption, cf. \cite{Steinmann2008:boundaryenergies}.

As shown in, e.g. \textsc{Öhman et al.} \cite{Ohman2011a}, it is possible to represent the surface tension force by an equivalent surface traction, henceforth denoted $\ta{t}_\fluct$, acting on the surface (or interface). In the presently assumed case of isotropic surface tension, $\ta{t}_\fluct$ is directed in the normal direction to the surface and is given as
%-----------------------------------------------------------------
\begin{equation}
    \ta{t}_\surf\defeq -\kappa\gamma_\surf\ta{n}
\label{eq103aKR}
\end{equation}
%------------------------------------------------------------------
where $\kappa\defeq\ta{n}\cdot\hat{\diff}$ is the curvature. Here, $\ta{n}$ is taken positive outwards from a convex surface, whereas $\hat\diff \defeq \diff - (\diff\cdot\ta{n})\ta{n}$ is the surface gradient operator.

%The smooth space-curved surface segment $\Gamma$, as shown in \figref{fig:surfacestress}, is considered as a ``thin shell'' acted upon by the tractions $\ta{t}^+$ and $\ta{t}^-$ on the upper and lower sides. These tractions are part of the final solution in the case $\Gamma$ is the contact interface of two bodies (solid or fluid) with different material properties. When $\Gamma$ is an outer surface, then $\ta{t}^+$ represents a prescribed loading (or reaction from prescribed displacement), whereas $-\ta{t}^-$ is the traction acting on the material just below the surface. In addition, the ``surface tension force'' $\hat{\ta t}$ acts in the tangent plane of the thin shell. Equilibrium is expressed as
%%-----------------------------------------------------------------
%\begin{equation}
%    \int_{\Gamma} \left[\ta{t}^+ + \ta{t}^-\right] \dif a = \int_{\partial\Gamma} \hat{\ta t} \dif l = \ta{0}
%\label{eq101KR}
%\end{equation}
%%------------------------------------------------------------------
%Upon introducing the ``surface stress'' tensor $\hat{\ts\sigma}$ (with components only in the tangent plane), such that $\hat{\ta t}=\hat{\ts\sigma}\cdot\ta{m}$ and $\hat{\ts\sigma}\cdot\ta{n}=\ta{0}$, we may use the surface divergence theorem for a smooth surface segment to rephrase the curve integral in \eqref{eq101KR} as
%%-----------------------------------------------------------------
%\begin{equation}
%    \int_{\partial\Gamma} \hat{\ts\sigma}\cdot\ta{m} \dif l = \int_{\Gamma} \hat{\ts\sigma}\cdot\hat{\diff} \dif a + \int_{\Gamma} \kappa\hat{\ts\sigma}\cdot\ta{n} \dif a = \int_{\Gamma} \hat{\ts\sigma}\cdot\hat{\diff} \dif a
%\label{eq102KR}
%\end{equation}
%%------------------------------------------------------------------
%Here, $\hat\diff \defeq \diff - \ta{n}\nabla_n$ is the surface gradient operator and $\kappa\defeq\ta{n}\cdot\hat{\diff}$ is the curvature and $\ta{n}\defeq\ta{n}^+$ is taken positive outwards from a convex surface. Combining \eqref{eq101KR} and \eqref{eq102KR} and localizing the result for any arbitrary choice of $\Gamma$, we obtain the strong format of traction equilibrium as follows:
%%-----------------------------------------------------------------
%\begin{equation}
%    \ta{t}^+ + \ta{t}^- + \ta{t}_\surf = \ta{0} \quad \mbox{on} \,\, \Gamma \quad \mbox{with } \ta{t}_\surf \defeq \hat{\ts\sigma}\cdot\hat{\diff}
%\label{eq103KR}
%\end{equation}
%%------------------------------------------------------------------
%where $\ta{t}_\surf$ is the ``surface tension traction''. Since it can be shown that $\ta{t}_\surf$ will depend on the (local) curvature, it is well-defined only when $\Gamma$ is sufficiently smooth
%
%Special case: Isotropic surface tension:
%
%Consider the special case that the surface tension is isotropic and homogeneous in the spatial format, i.e. $\hat{\ts\sigma}=\gamma_\surf\hat{\ts I}$, where $\gamma_\surf$ is a constant parameter and $\hat{\ts I} \defeq \ts{I} - \ta{n}\outerp\ta{n}$ is the surface identity tensor. Using the identity $\hat{\ts I}\cdot\hat{\diff}=-\kappa\ta{n}$, we then obtain
%%-----------------------------------------------------------------
%\begin{equation}
%    \sum_i \gamma_{\surf,i}\ta{m}_i = \ta{0} \quad \mbox{on} \,\, \mathcal{C}
%\label{eq104aKR}
%\end{equation}
%%------------------------------------------------------------------


\subsection{Incompressible viscous flow of the Stokes' type}

We shall adopt a model for the subscale deformation within the solid particles undergoing the time-dependent sintering process. The model is simplified in the sense that elastic deformation is neglected a priori. It is then possible to consider a viscoplastic (fluid-like) material with intrinsic incompressibility (within the particles). Such incompressibility is expressed as $d_\vol\defeq\ta{v}\cdot\ts{\nabla}=0$ and, hence, $\ts{d}_\dev=\ts{d}$. An isotropic and associated viscoplastic flow rule of the classical Perzyna type is proposed as follows:
%-----------------------------------------------------------------
\begin{equation}
    \ts{d}_\dev = \frac{1}{2\mu}\ts{\sigma}_\dev + \ts{d}_\dev^\pl(\ts{\sigma}_\dev), \quad
    \ts{d}_\dev^\pl = \frac{1}{t_*}\eta\left(\Phi\left(\sigma_\eqv\right)\right)\od{\Phi}{\ts\sigma}
\label{eq201}
\end{equation}
%------------------------------------------------------------------
where $t_*$ is the relaxation time, $\eta(\Phi)$ is an overstress function, $\Phi(\sigma_\eqv)$ is the quasistatic yield function and $\sigma_\eqv=\sqrt{\frac{3}{2}}|\ts{\sigma}_\dev|$ is the equivalent stress. Upon introducing the abbreviated notation $k=\frac{\eta}{t_*}\od{\Phi}{\sigma_\eqv}$, we may solve for $\sigma_\eqv$ in terms of the equivalent rate of deformation $d_\eqv\defeq\sqrt{\frac{2}{3}}|\ts{d}_\dev|$ from the equation
%-----------------------------------------------------------------
\begin{equation}
    \frac{1}{3\mu}\sigma_\eqv + k\left(\sigma_\eqv\right) = d_\eqv
\label{eq202}
\end{equation}
%------------------------------------------------------------------
and we, finally, obtain the ``Newtonian-like'' constitutive relation
%-----------------------------------------------------------------
\begin{equation}
    \ts{\sigma}_\dev(\ts{d}) = 2\tilde{\mu}\ts{d}_\dev, \quad
    \tilde{\mu}\defeq \frac{\sigma_\eqv}{3d_\eqv}
    %\frac{\mu}{1+\frac{3\mu k\left(\sigma_\eqv\left(d_\eqv\right)\right)}{\sigma_\eqv\left(d_\eqv\right)}}
\label{eq203}
\end{equation}
%------------------------------------------------------------------

The corresponding tangent stiffness $\tf{E}_{\tang,\dev}$ in the relation $\dif\ts{\sigma}_\dev=\tf{E}_{\tang,\dev}\dprod\dif\ts{d}$ (representing the linearization of the subscale constitutive problem), is given as follows:
%------------------------------------------------------------------
\begin{align}
 \tf E_{\tang,\dev} &= 2\tilde{\mu} \tf I_\dev + \frac{4}{9 d_\eqv^2} \left[ d_\eqv \left[ \frac{1}{3\mu} + k' \right]^{-1} - \sigma_\eqv \right] \ts d_\dev \outerp\ts d_\dev
 %\intertext{with}
 ,\quad k' = \frac{1}{t_*}\left[\eta \frac{\mathrm{d}^2\;\Phi}{\dif\sigma_\eqv^2} + \od{\eta}{\Phi}\left[\od{\Phi}{\sigma_\eqv}\right]^2\right].
\end{align}
%------------------------------------------------------------------

In the absence of acceleration, the balance equations for the quasi-static motion of the assembly of viscoplastic particles can be established in the spatial setting as follows:
%-----------------------------------------------------------------
\begin{subequations}\label{eq204}
\begin{align}
    -\ts{\sigma}\cdot\diff & = \ts{0} \quad \mbox{ in }\,\Omega^\particle
\label{eq204a}
\\
    \ta{v}\cdot\diff & = 0 \quad \mbox{ in }\,\Omega^\particle
\label{eq204b}
\end{align}
\end{subequations}
%------------------------------------------------------------------
where $\ts{\sigma}(\ts{d})=\ts{\sigma}_\dev(\ts{d}_\dev)-p\ts{I}$ is the total Cauchy stress, $p$ is the pressure (Lagrangian multiplier corresponding to the incompressibility constraint), and
where $\diff$ denotes the spatial gradient.

In order to establish the weak format of \eqref{eq204} for a sintering body, we henceforth assume (for simplicity) that the surface tension along the contact surfaces $\Gamma^\contact$ can be ignored; hence, the internal boundary of the domain $\Omega^\particle$ occupied by the particle assembly is $\Gamma^\pore$. It then appears that the space-variational forms of \eqref{eq204} read:
%-----------------------------------------------------------------
\begin{subequations}\label{eq205}
\begin{align}
    \int_{\Omega^\particle} \ts{\sigma}\dprod\delta \ts{d} \dif v
    & =
    \int_{\Gamma^\pore} \ta{t}_\surf \cdot \delta\ta{v} \dif a
%    - \int_{\Gamma^\internal} \hat{\ts\sigma}\dprod\left[\delta\ta{v}\outerp\hat{\diff}\right] \dif a
    + \int_{\Gamma^\external_\Neumann} \bar{\ta t}_\prescribed\cdot\delta \ta{v} \dif a
\label{eq205a} \\
    \int_{\Omega^\particle} \left[\ta{v}\cdot\diff\right] \delta p \dif v
    & =  0
\label{eq205b}
\end{align}
\end{subequations}
%------------------------------------------------------------------
for suitable test functions $\delta\ta{v}$ and $\delta p$ that satisfy the appropriate regularity requirements (not further elaborated in this paper). Here it was used that $\delta\ta{v}=\ta{0}$ on $\Gamma^\external_\Dirichlet$.

\textbf{Remark}: In the special case of isotropic surface tension (not necessarily state-independent or homogeneous), the operational format of \eqref{eq205a} is obtained by using the more explicit expression for the integral that represents ``surface tension loading'':
%-----------------------------------------------------------------
\begin{equation}
    \int_{\Gamma^\pore} \ta{t}_\surf \cdot \delta\ta{v} \dif a =
    \int_{\Gamma^\pore} \gamma_\surf\left[\delta\ta{v}\cdot\hat{\diff}\right] \dif a
\label{eq206}
\end{equation}
%------------------------------------------------------------------
where the surface divergence theorem was used for any smooth pore surface segment $\Gamma^\pore_i$. $\Box$

\subsection{Representative Volume Element}

In a 2D-representation of the mesoscale features, the appropriately chosen RVE is assumed to occupy the bulk volume $\Omega_\Box(t)$ with side length $L_\Box(t)$. The RVE must obviously contain a sufficient number of particles and pores to qualify as ``representative'' in the classical sense; however, in order to simplify the subsequent conceptual discussion and ``pave the way'' for the subsequent homogenization, we consider a simple arrangement of particles within the RVE. In the very simplest case, the RVE consists of one single ``unit cell'' containing a single contiguous pore.

The current ``bulk'' domain of the RVE at a time $t>0$ contains the particles and the pore space, $\Omega_\Box(t)=\Omega^\particle_\Box(t)\cup\Omega_\Box^\pore(t)$, where $\Omega_\Box^\pore(t)$ is the domain currently occupied by the pore, whereas $\Omega_\Box^\particle(t)$ is occupied by the particles. This is shown schematically in \figref{fig:4particle_rve_b}.
%\footnote{Henceforth, when the time argument is dropped, e.g. $\Omega_\Box$, the current configuration is referred to.}.
The external boundary of the RVE is $\partial\Omega_\Box(t)\defeq\Gamma_\Box(t)$. The initial configuration of the particles within the RVE (before any deformation has taken place) is denoted $\Omega_\Box(0)$, as shown in \figref{fig:4particle_rve_a}. It is noted that in 2D, by assumption, the external boundary of the RVE always cuts through the particles and never through the pore space. The boundaries of the (closed) pore-space are collectively denoted $\Gamma_\Box^\pore(t)$. The boundary of the deforming particles currently contained in the RVE is then $\partial\Omega^\particle_\Box(t)=\Gamma_\Box(t)\cup\Gamma_\Box^\pore(t)$.
%-------------------------------------------------------------------------
\begin{figure}[th!]
    \centering
    \subfloat[$t = 0$]{\input{figures/4particle_rve.tikz}\label{fig:4particle_rve_a}}
    \subfloat[$t > 0$]{\input{figures/4particles_deformed.tikz}\label{fig:4particle_rve_b}}
    \caption{(a) Initial configuration of RVE in 2D consisting of circular particles in a perfect square lattice. The contact ``points'' are flattened due to precompaction. (b) Deformed configuration (sketchy).}
    \label{fig:4particleRVE}
\end{figure}
%-----------------------------------------------------------------------------

\section{Macroscale problem}\label{sec:macro}

\subsection{Transition to macroscopic incompressibility}

In the paper by \textsc{Öhman et al.} \cite{Ohman2011a} the macroscale format is restricted to the situation that the response is compressible. However, this format is inadequate and the algorithm breaks down when the macroscale response becomes incompressible, which situation is encountered when the porosity vanishes (locally). This is intuitively clear; however, it can be shown readily as follows:

Consider the RVE occupying the current domain $\Omega_\Box$, as shown in Figure \ref{fig:4particleRVE}, and consider the condition of intrinsic incompressibility, $\ta{v}\cdot\diff=0$ in $\Omega_\Box^\particle$, from which it follows that
%----------------------------------------------------------------------------
\begin{equation}
    \langle \ta{v}\cdot\diff \rangle_\Box  = 0
\label{eq230}
\end{equation}
%----------------------------------------------------------------------------
In standard fashion, the explicit part of the prolonged macroscale field, denoted $\ta{v}^\macro$, is assumed to vary only \emph{linearly} within the RVE, i.e.
%----------------------------------------------------------------------------
\begin{equation}
    \ta{v} = \ta{v}^\macro + \ta{v}^\fluct =
    \bar{\ts d} \cdot [\ta{x}-\bar{\ta{x}}] + \ta{v}^\fluct \mbox{ for }\ta{x}\in\Omega_\Box,
    \label{eq409}
\end{equation}
%----------------------------------------------------------------------------
where $\bar{\ts d}=\bar{\ts d}_\dev+\frac{1}{3}\bar{d}_\vol\ts{I}=\left[\bar{\ta v}\outerp\diff\right]^\sym$ is the value of the macroscale rate-of-deformation tensor in the center of the RVE. Upon introducing this relation into \eqref{eq230}, we obtain directly (with $\bar{d}_\vol\defeq\ts{I}\dprod\bar{\ts d}=\bar{\ta v}\cdot\diff$) the identity
%----------------------------------------------------------------------------
\begin{equation}
    \bar{d}_\vol = - \frac{1}{1-\phi}\frac{1}{|\Omega_\Box|}\int_{\Gamma_\Box^\pore\cup\Gamma_\Box} \ta{v}^\fluct\cdot\ta{n} \dif a
    \label{eq410}
\end{equation}
%----------------------------------------------------------------------------
where $\phi\defeq 1-\frac{\Omega_\Box^\particle}{\Omega_\Box}$ is the (current) macroscopic porosity. The fluctuation field $\ta{v}^\fluct\{\bar{\ts d}\}$ is computed from the RVE-problem for given value of $\bar{\ts d}$. Now, let us consider the situation of Dirichlet boundary conditions in the RVE-problem, $\ta{v}^\fluct=\ta{0}$, on (the exterior boundary) $\Gamma_\Box$ and the boundary integral in \eqref{eq410} reduces to $\Gamma_\Box^\pore$. When the porosity vanishes, then $\Gamma_\Box^\pore$ disappears and we obtain $\bar{d}_\vol = 0$, which is a ``pathological'' situation from the point of view of the macroscale format. It is noted that, from the moment incompressibility is a fact, it is possible to trace the isochoric macroscale flow only if a mixed variational format is employed in terms of $(\bar{\ta v},\bar{p})$, where $\bar{p}$ is the macroscale pressure (negative mean stress). This mixed format is derived next.


\subsection{Mixed format of the macroscale problem}

\subsubsection{Preliminaries}

Classical model-based homogenization is adopted upon introducing the volume-averaged virtual work expresssion (LHS in \eqref{eq205a}) on the characteristic Representative Volume Element (RVE), as defined in Figure \ref{fig:4particleRVE}, and integrating on the entire macroscopic domain $\Omega(t)$. We may then express the homogenized internal virtual work as
%----------------------------------------------------------------------------------------------------
\begin{equation}
    a(\ta{v},p; \delta \ta{v}^\macro) \defeq
    \int_{\Omega} \left[
    a_\Box(\ta{v};\delta \ta{v}^\macro) + b_\Box(p, \delta \ta{v}^\macro) - l_\Box^\pore(\delta \ta{v}^\macro)
    \right] \dif v
    = \int_{\Omega} l_\Box(\delta \ta{v}^\macro) \dif v
\label{eq402a}
\end{equation}
%-----------------------------------------------------------------------------------------------------
where we introduced the subscale variational forms\footnote{$\langle[\bullet]\rangle_\Box\defeq\frac{1}{|\Omega_\Box|}\int_{\Omega^\particle_\Box}[\bullet] \, \dif v$ is the bulk volume average on the RVE of a quantity associated with particles in the domain $\Omega_\Box$.}
%----------------------------------------------------------------------------
\begin{align}
    a_\Box(\ta{v};\delta \ta{v})
    & \defeq
    \langle \ts{\sigma}_\dev(\ts{d}) \dprod \delta \ts{d} \rangle_\Box =
    \frac{1}{|\Omega_\Box|}\int_{\Omega^\particle_\Box} \ts{\sigma}_\dev(\ts{d}) \dprod \left[\delta \ta{v}\outerp\diff\right]^\sym \dif v
\label{eq403a}
\\
    b_\Box(p, \ta{v})
    & \defeq
    - \langle p\,\ts{I}\dprod\ts{d} \rangle_\Box =
    - \langle p\,\ta{v}\cdot\diff \rangle_\Box =
    - \frac{1}{|\Omega_\Box|}\int_{\Omega^\particle_\Box} p \left[\ta{v}\cdot\diff\right] \dif v
\label{eq403b}
\\
    l_\Box^\pore(\delta \ta{v})
    & \defeq
    \frac{1}{|\Omega_\Box|} \int_{\Gamma_\Box^\pore} \ta{t}_\surf \cdot \delta\ta{v} \dif a
\label{eq403c}
\\
    l_\Box(\delta \ta{v})
    & \defeq
    \frac{1}{|\Omega_\Box|} \int_{\Gamma_\Box} \ta{t} \cdot \delta\ta{v} \dif a
\label{eq403d}
\end{align}
%----------------------------------------------------------------------------
for suitably chosen test velocity field $\delta\ta{v}$ such that $\delta\ts{d}\defeq\left[\delta\ta{v}\outerp\diff\right]^\sym$ is the corresponding rate-of-deformation tensor. Here, $\ta{t}$ denotes the total traction on the RVE-boundary.

We next use the decomposition of the local velocity field within each RVE as represented in \eqref{eq409}, which may be inserted into \eqref{eq402a} to give
\begin{align}
    a(\ta{v},p; \delta \ta{v}^\macro)
    & =
    \int_\Omega
    \bar{\ts\sigma} \dprod \delta\bar{\ts d} \dif v =
    \int_\Omega
    \bar{\ts\sigma} \dprod \left[\delta\bar{\ta v}\outerp\diff\right]^\sym \dif v
    \nonumber \\
    & =
    \int_\Omega
    \left[\bar{\ts\sigma}_{\dev} \dprod \delta\bar{\ts d}_\dev -
    \bar{p}\delta\bar{d}_\vol\right] \dif v =
    \int_\Omega
    \left[\bar{\ts\sigma}_{\dev} \dprod \left[\delta\bar{\ta v}\outerp\diff\right]^\sym_\dev -
    \bar{p}\left[\delta\bar{\ta v}\cdot\diff\right]\right]
    \dif v
\label{eq403f}
\end{align}
%------------------------------------------------------------------------
In \eqref{eq403f}, we introduced the energy-conjugated macroscale deviatoric stress tensor $\bar{\ts\sigma}_\dev$ and pressure $\bar{p}$, which are deduced as follows: $\bar{\ts\sigma}_\dev\defeq\bar{\ts\sigma}+\bar{p}\ts{I}$, $\bar{p}\defeq-\frac{1}{3}\bar{\ts\sigma}\dprod\ts{I}$ with
%-----------------------------------------------------------------
\begin{equation}
    \bar{\ts\sigma} =
    \langle \ts{\sigma} \rangle_\Box -
    \frac{1}{|\Omega_\Box|}\int_{\Gamma_\Box^\pore} \ta{t}_\fluct\outerp[\ta{x}-\bar{\ta{x}}]^\sym \dif a =
    \frac{1}{|\Omega_\Box|}\int_{\Gamma_\Box} \ta{t}\outerp[\ta{x}-\bar{\ta{x}}]^\sym \dif a
\label{eq403g}
\end{equation}
%------------------------------------------------------------------

Note that we have not introduced (or implicitly used) any assumption as to macroscopic (in)compressibility. Hence, the ``mixed'' expression in \eqref{eq403f} is valid for compressible as well as for incompressible macroscale response (although the intrinsic response is incompressible). However, we shall aim at a mixed formulation that uses $\bar{\ta{v}}$ and $\bar{p}$ as the independent macroscale fields.

As to the appropriate macroscale representation of the intrinsic incompressibility condition expressed in \eqref{eq230}, we note that the weak format of \eqref{eq410} can be expressed generally as
%-----------------------------------------------------------------
\begin{equation}
    \int_\Omega \left[\bar{\ta v}\cdot\diff\right]\delta\bar p \dif v =
    \int_\Omega \bar{d}_\vol\delta\bar p \dif v
\label{eq403h}
\end{equation}
%------------------------------------------------------------------
for suitably chosen test pressure field $\delta\bar{p}$, where $\bar{d}_\vol$ depends on the subscale fluctuation field $\ta{v}^\fluct$. In its turn, $\ta{v}^\fluct$ depends on $\bar{\ta{v}}$ and $\bar{p}$ in an implicit manner via the solution of the RVE-problem (as discussed subsequently). How to express this dependence in a formal fashion in the mixed macroscale variational setting is discussed next.


\subsubsection{Compressible macroscale response}

As long as the porosity is non-zero and macroscopic compressibility prevails, the straight-forward approach is to carry out homogenization to obtain the macroscale stress $\bar{\ts\sigma}$ as an implicit function of $\bar{\ts d}$ (with $\bar{d}_\vol\neq 0$), i.e. we may write this implicit relation as
%----------------------------------------------------------------------------
\begin{equation}
   \bar{\ts\sigma} = \bar{\ts\sigma}_\Box\{\bar{\ts d}\} = \bar{\ts\sigma}_\Box\{\bar{\ts d}_\dev +\frac13\bar{d}_\vol\ts I\}
\label{eq416a}
\end{equation}
%----------------------------------------------------------------------------
However, in order to obtain a unified formulation that holds also for the situation when the macroscale response becomes incompressible, it is desirable to introduce a mixed variational format in terms of $\bar{\ts d}_\dev=\left(\bar{\ta v}\outerp\diff\right)^\sym_\dev$ and $\bar{p}$ as the ``prolongation variables'' that are imposed as input to the RVE-problem in a nested macroscale-subscale algorithm. This is achieved as follows:

For given values of $\bar{\ts d}_\dev$ and $\bar{p}$, the corresponding value $\bar{d}_\vol$ can be computed from the condition
%----------------------------------------------------------------------------
\begin{equation}
    -\frac13 \ts I\dprod \bar{\ts\sigma}_\Box\{\bar{\ts d}_\dev +\frac13\bar{d}_\vol\ts I\} = \bar p
\label{eq416}
\end{equation}
%----------------------------------------------------------------------------
and the solution is expressed as the the implicit function $\bar{d}_{\Box,\vol}\{\bar{\ts d}_\dev,\bar{p}\}$. The deviatoric stress can then be computed as
%----------------------------------------------------------------------------
\begin{equation}
    \bar{\ts\sigma}_{\dev} = \bar{\ts\sigma}_{\Box,\dev}\{\bar{\ts d}_\dev,\bar p\} \defeq \bar{\ts\sigma}_\Box\{\bar{\ts d}_\dev + \frac13 \bar{d}_\vol\ts I\} + \bar{p}\ts{I}
\label{eq418}
\end{equation}
%----------------------------------------------------------------------------
Finally, for given $\bar{\ts d}_\dev$ and $\bar{p}$, we summarize the ``mixed'' relations
%----------------------------------------------------------------------------
\begin{align}
 \bar{\ts\sigma} & =  \bar{\ts\sigma}_{\Box,\dev}\{\bar{\ts d}_\dev,\bar p\} - \bar p\ts I
\label{eq418a}\\
 \bar{d}_\vol & =  \bar{d}_{\Box,\vol}\{\bar{\ts d}_\dev, \bar p\}
\label{eq418b}
\end{align}
%----------------------------------------------------------------------------

\subsubsection{Incompressible macroscale response}

When the porosity vanishes and the macroscale response becomes incompressible, then $\bar{p}$ becomes a Lagrange multiplier corresponding to the constraint condition $\bar{d}_{\vol} = 0$. In other words, the relations in \eqref{eq418a}, \eqref{eq418b} are still valid if we set $\bar{d}_{\Box,\vol}\{\bar{\ts d}_\dev,\bar p\} = 0$.

\subsubsection{Mixed variational format of the macroscale problem}

Using the expressions \eqref{eq418a} and \eqref{eq418b}, we are in the position to formulate the ``unified'' macroscale problem as follows: Find $(\bar{\ta v},\bar p) \in\bar{\set V}\times\bar{\set{P}}$ that solve
%----------------------------------------------------------------------------
\begin{subequations}\label{eq411}
\begin{align}
 \bar a\{\bar{\ta v},\bar p; \delta\bar{\ta v}\} + \bar b\{\bar p, \delta\bar{\ta v}\} &= \bar l\{\delta\bar{\ta v}\}   &&\quad \forall\; \delta\bar{\ta v} \in \bar{\set{V}}^0
 \label{eq411a}\\
 \bar b\{\delta\bar p, \bar{\ta v}\} + \bar c\{\bar{\ta v}, \bar p; \delta\bar p\}&= 0   &&\quad \forall\; \delta\bar p \in \bar{\set{P}}
 \label{eq411b}
\end{align}
\end{subequations}
%----------------------------------------------------------------------------
where the pertinent variational forms are given as
%----------------------------------------------------------------------------
\begin{align}
 \bar a\{\bar{\ta v},\bar p; \delta\bar{\ta v}\} &\defeq \int_\Omega \bar{\ts\sigma}_{\Box,\dev}\{\left[\bar{\ta v}\outerp \diff\right]^\sym_\dev,\bar p\}\dprod \left[\delta\bar{\ta v}\outerp \diff\right]^\sym_\dev \dif v
 \label{eq412a}\\
 \bar b\{\bar p, \delta\bar{\ta v}\}             &\defeq -\int_\Omega \bar p\left[\delta\bar{\ta v}\cdot\diff\right]\dif v
 \label{eq412b}\\
 \bar c\{\bar{\ta v}, \bar p; \delta\bar p\}     &\defeq \int_\Omega \bar d_{\Box,\vol}\{\left[\bar{\ta v}\outerp \diff\right]^\sym_\dev,\bar p\}\delta\bar p\dif v
 \label{eq412c}\\
 \bar l\{\delta\bar {\ta v}\}               &\defeq \int_{\Gamma^\external_\Neumann} \bar{\ta t}_\prescribed\cdot \delta\bar{\ta v} \dif a
 \label{eq412d}
\end{align}
%----------------------------------------------------------------------------
In order to motivate the boundary term \eqref{eq412d}, we have assumed sufficient smoothness of the prescribed traction $\bar{\ta t}_\prescribed$.

Newton iterations for solving the system \eqref{eq411} employ the algorithmic tangents
%----------------------------------------------------------------------------
\begin{subequations}\label{eq413}
\begin{align}
 \dif \bar{\ts\sigma}_{\Box,\dev} &= \bar{\tf E}_\ded \dprod \dif\bar{\ts d}_\dev + \bar{\ts E}_\dep \dif\bar{p}
 \label{eq413a} \\
 \dif \bar{d}_{\Box,\vol} &= \bar{\ts C}_\ded \dprod \dif \bar{\ts d}_\dev + \bar{C}_\dep \dif\bar{p}
 \label{eq413b}
\end{align}
\end{subequations}
%-----------------------------------------------------------------------------
such that the increments $\Delta\bar{\ta v}$ and $\Delta\bar{p}$ are obtained from the system
%----------------------------------------------------------------------------
\begin{alignat}{4}
  &\bar{a}'_\derv\{\bullet; \delta\bar{\ta v},\Delta\bar{\ta v}\} + \bar{a}'_\dep\{\bullet; \delta\bar{\ta v},\Delta\bar{p}\} + \bar{b}\{\Delta\bar p, \delta{\ta v}\}
  &&= \bar l\{\delta\bar{\ta v}\} - \bar{a}\{\bullet; \delta\bar{\ta v}\} - \bar{b}\{\bullet, \delta\bar{\ta v}\}
  &\quad&\forall\; \delta\bar{\ta v} &&\in \bar{\set{V}}^0
\label{eq414a}\\
  &\bar{b}\{\delta\bar p, \Delta\bar{\ta v}\} + \bar{c}'_\derv\{\bullet; \delta\bar{p}, \Delta\bar{ \ta v}\} + \bar{c}'_\dep\{\bullet; \delta\bar{p},\Delta\bar{p}\}
  &&= -\bar{b}\{\delta\bar{p},\bullet\} - \bar{c}\{\bullet;\delta\bar{p}\}
  &&\forall\; \delta\bar{p} &&\in \bar{\set{P}}
 \label{eq414b}
\end{alignat}
%----------------------------------------------------------------------------
where
%----------------------------------------------------------------------------
\begin{align}
 \bar{a}'_\derv\{\bullet; \delta\bar{\ta v},\Delta\bar{\ta v}\} &= \int_\Omega \left[\delta\bar{\ta v}\outerp\diff\right]^\sym_\dev \dprod \bar{\tf{E}}_\ded \dprod \left[\Delta\bar{\ta v}\outerp\diff\right]^\sym_\dev \dif V
 \label{eq415a}\\
 \bar{a}'_\dep\{\bullet; \delta\bar{\ta v},\Delta\bar{p}\}     &= \int_\Omega \left[\delta\bar{\ta v}\outerp\diff\right]^\sym_\dev \dprod \bar{\ts E}_\dep \,\Delta\bar{p} \dif V
 \label{eq415b}\\
 \bar{c}'_\derv\{\bullet; \delta\bar{p}, \Delta\bar{ \ta v}\}   &= \int_\Omega \delta\bar{p} \,\bar{\ts C}_\ded \dprod \left[\Delta\bar{\ta v}\outerp\diff\right]^\sym_\dev \dif V
 \label{eq415c}\\
 \bar{c}'_\dep\{\bullet; \delta\bar{p},\Delta\bar{p}\}         &= \int_\Omega \delta\bar{p} \,\bar{C}_\dep \Delta\bar p\dif V
 \label{eq415d}
\end{align}
%----------------------------------------------------------------------------
\textbf{Remark}: The problem in \eqref{eq411} does indeed represent both macroscopically compressible and incompressible states such that the transition is ``seamless''.
In the incompressible case, \eqref{eq411} can be replaced by the classical format
%----------------------------------------------------------------------------
\begin{subequations}\label{eq420}
\begin{alignat}{3}
 &\bar a\{\bar{\ta v},\bar p; \delta\bar{\ta v}\} + \bar b\{\bar p, \delta\bar{\ta v}\}
 &&= 0
 &\quad& \forall\; \delta\bar{\ta v} \in \bar{\set{V}}^0
 \label{eq420a}\\
 &\bar b\{\delta\bar p, \bar{\ta v}\}
 &&= 0
 &\quad& \forall\; \delta\bar p \in \bar{\set{P}}
 \label{eq420b}
\end{alignat}
\end{subequations}
%----------------------------------------------------------------------------
However, \eqref{eq411} is retained as the operational formulation in practice. $\Box$

\section{RVE-problem for given macroscale fields}\label{sec:rve_problem}


\subsection{Variational format -- Dirichlet boundary conditions}

The task is to obtain the homogenized response for prescribed values of $\bar{\ts d}_\dev$ and $\bar{p}$. The variables to be returned to the macroscale equilibrium equation are $\bar{\ts\sigma}_\dev=\bar{\ts\sigma}_{\Box,\dev}\{\bar{\ts d}_\dev,\bar{p}\}$ and $\bar{d}_\vol=\bar{d}_{\Box,\vol}\{\bar{\ts d}_\dev, \bar{p}\}$. Henceforth, we shall adopt Dirichlet boundary conditions on the local fluctuation part of the velocity field, $\ta{v}^\fluct$. We are lead to the following trial and test spaces:
%----------------------------------------------------------------------------
\begin{align}
    \set V_\Box^{(\Dirichlet)} &= \{\ta{v} \mbox{ sufficiently regular in } \Omega_\Box, \,\, \ta{v}=\ta{0}\,\,\mbox{on}\,\,\Gamma_\Box\}
\label{eq:rve_functions_v}\\
    \set{P}_\Box &= \{p\in L_2(\Omega_\Box)\}
\label{eq:rve_functions_p}
\end{align}
%----------------------------------------------------------------------------
The appropriate space-variational format of the RVE-problem can now be formulated as follows (a derivation is given in the Appendix): For given macroscale variables $\bar{\ts d}_\dev$ and $\bar{p}$,
find ($\bar{d}_\vol,p,\ta{v}^\fluct)\in\set{R}\times\set{V}_\Box^{(\Dirichlet)}\times\set{P}_\Box$ that solve the system
%----------------------------------------------------------------------------
\begin{subequations}\label{eq213}
\begin{alignat}{4}
    & a_\Box(\ta{v}^\macro_\dev + \ta{v}^\fluct;\delta \ta{v}^\fluct) +  b_\Box(p,\delta\ta{v}^\fluct)
    && =
    l^\pore_\Box(\delta \ta{v}^\fluct)
    &\quad& \forall\; \delta \ta{v}^\fluct &&\in \set{V}_\Box^{(\Dirichlet)}
\label{eq213a}
 \\
    &b_\Box(\delta p, \ta{v}^\macro_\vol(\bar{d}_\vol)+\ta{v}^\fluct)
    && =
    0
    && \forall\; \delta p &&\in \set{P}_\Box
\label{eq213b}
\\
    &b_\Box(p,\ta{x}_\mean)\delta\bar{d}_\vol
    && =
    [\bar{p} - l_\Box^\pore(\ta{x}_\mean)]\delta\bar{d}_\vol
    && \forall\; \delta\bar{d}_\vol &&\in \set{R}
\label{eq213c}
\end{alignat}
\end{subequations}
%%----------------------------------------------------------------------------
It is noted that the ``macroscale'' part, $\ta{v}^\macro=\ta{v}^\macro_\dev+\ta{v}^\macro_\vol$, of $\ta{v}$ is decomposed into the deviatoric and volumetric parts as follows:
%----------------------------------------------------------------------------
\begin{align}
 \label{eq:vMdev} \ta{v}^\macro_\dev &\defeq \bar{\ts d}_\dev\cdot[\ta{x}-\bar{\ta{x}}]\\
 \label{eq:vMvol} \ta{v}^\macro_\vol &\defeq \bar{d}_\vol\ta{x}_\mean,\quad \ta{x}_\mean \defeq \frac13[\ta x-\bar{\ta x}]
\end{align}
Whereas $\bar{\ts d}_\dev$ is directly computed from the macroscale problem, $\bar{d}_\vol$ is computed from the RVE-problem and is thus implicitly dependent on the macroscale solution via $\bar{\ts d}_\dev\defeq[\bar{\ta v}\outerp\diff]^\sym_\dev$ and $\bar{p}$.

%----------------------------------------------------------------------------
The output variables from the RVE-problem, that will be ``returned'' to the macroscale problem \eqref{eq411} in a nested FE$^2$-iteration procedure, are $\bar{d}_\vol$ and $\bar{\ts\sigma}_\dev$. Whereas $\bar{d}_\vol$ is a direct part of the solution of the RVE-problem, $\bar{\ts\sigma}_\dev$ is post-processed as discussed subsequently.

\textbf{Remark}: It was used explicitly in \eqref{eq213a} that $\ta{\sigma}_\dev$ is proportional to ${\ts d}_\dev$; hence, it depends on $\bar{\ts d}_\dev$ (via $\ta{v}^\macro_\dev$) but \emph{not} on $\bar{d}_\vol$ (via $\ta{v}^\macro_\vol$). $\Box$

The RVE-problem \eqref{eq213} must be solved iteratively in practice due to the
subscale nonlinearities. To this end, we first rewrite the RVE-problem as the vanishing residuals
%----------------------------------------------------------------------------
\begin{subequations}
\begin{alignat}{4}
  &R_\Box^\derv(\ta{v}^\fluct,p; \delta \ta{v}^\fluct)
  && \defeq l_\Box^\pore(\delta \ta{v}^\fluct) -
    a_\Box(\ta{v}^\macro_\dev+\ta{v}^\fluct;\delta \ta{v}^\fluct) -
    b_\Box(p,\delta\ta{v}^\fluct)
  &\quad& \forall\; \delta \ta{v}^\fluct &&\in \set{V}_\Box^{(\Dirichlet)}
  \\
  &R_\Box^\dep(\bar{d}_\vol,\ta{v}^\fluct; \delta p)
  && \defeq - b_\Box(\delta p,\ta{v}^\macro_\vol(\bar{d}_\vol)+\ta{v}^\fluct)
  && \forall\; \delta p &&\in \set{P}_\Box
  \\
  &R_\Box^\ded(p;\delta\bar{d}_\vol)
  && \defeq [\bar{p} - l_\Box^\pore(\ta{x}_\mean)- b_\Box(p,\ta{x}_\mean)]\delta\bar{d}_\vol
  && \forall\; \delta\bar{d}_\vol &&\in \set{R}
\end{alignat}
\end{subequations}
%----------------------------------------------------------------------------
Newton's iteration method for finding the unknown variables
$\bar{d}_\vol, \ta{v}^\fluct$ and $p$ for given $\bar{\ts d}_\dev$ and $\bar{p}$ then becomes: For $k=1,2,\ldots,$ compute
%----------------------------------------------------------------------------
\begin{equation}
    \bar{d}_\vol^{(k+1)} = \bar{d}_\vol^{(k)} + \Delta \bar{d}_\vol, \quad
    {\ta{v}}^{\fluct(k+1)} = {\ta{v}}^{\fluct(k)} + \Delta {\ta{v}}^\fluct, \quad
    p^{(k+1)} = p^{(k)} + \Delta p
\label{eq251}
\end{equation}
%----------------------------------------------------------------------------
where the iterative updates $\Delta\bar{d}_\vol\in\set{R}, \Delta {\ta{v}}^\fluct\in{\set{V}}_\Box^{(\Dirichlet)}$ and $\Delta p \in{\set{P}}_\Box$ are solved from the tangent equations
%----------------------------------------------------------------------------
\begin{subequations}\label{eq252b}
\begin{alignat}{4}
    &(a_\Box)'(\ta v^\macro_\dev + \ta v^\fluct; \delta\ta{v}^\fluct,\Delta \ta{v}^\fluct)
    + b_\Box(\Delta p,\delta\ta{v}^\fluct)
    && = R_\Box^\derv(\bullet^{(k)}; \delta\ta{v}^\fluct)
    &\quad& \forall\; \delta \ta{v}^\fluct &&\in \set{V}_\Box^{(\Dirichlet)}
    \\
    &b_\Box(\delta p,\ta{v}^\macro_\vol(\Delta\bar{d}_\vol) + \Delta\ta{v}^\fluct)
    && = R_\Box^\dep(\bullet^{(k)}; \delta p)
    && \forall\; \delta p &&\in \set{P}_\Box
    \\
    &b_\Box(\Delta p,\ta{x}_\mean)\delta\bar{d}_\vol
    && = R_\Box^\ded(\bullet^{(k)}; \delta\bar{d}_\vol)
    && \forall\; \delta\bar{d}_\vol &&\in \set{R}
\end{alignat}
\end{subequations}
%----------------------------------------------------------------------------
until the residuals are sufficiently small.
The tangent form $(a_\Box)'$ is given explicitly as
%----------------------------------------------------------------------------
\begin{align}
    (a_\Box)'(\bullet; \delta \ta{v}^\fluct,\Delta{\ta{v}}^\fluct)
    & =
    \left\langle \left[\delta\ta{v}\outerp\diff\right]^\sym \dprod \tf{E}_{\majorT,\dev}(\bullet) \dprod
    \left[\Delta\ta{v}^\fluct\outerp\diff\right]^\sym \right\rangle_\Box
\end{align}
%----------------------------------------------------------------------------
\textbf{Remark}: In the macroscopically incompressible case, we will obtain $\bar{d}_\vol=0$ as part of the solution of the RVE-problem. $\Box$

\subsection{Macroscale algorithmic tensors}

The algorithmic tensors $\bar{\tf{E}}_\ded, \bar{\ts E }_\dep, \bar{\ts C}_\ded$ and $\bar{C}_\dep$, needed in order to carry out macroscale Newton iterations, are obtained for
perturbations of the RVE-solution expressed in terms of perturbations of $\bar{\ts d}_\dev$ and $\bar{p}$. However, these perturbations are not entirely straightforward since the components of $\bar{\ts d}_\dev$ are not all independent. In fact, they must satisfy the constraint $\bar{\ts d}_\dev\dprod{\ts I}=0$. To circumvent this difficulty, we replace the standard dyad bases with the new orthonormal bases $\ts E_i$, i.e. $\ts E_i \dprod \ts E_j = \delta_{ij}$, such that they satisfy the constraint $\ts E_i\dprod{\ts I}=0$. Examples of such bases are shown in the Appendix. We may now adopt the expansions
%----------------------------------------------------------------------------
\begin{align}
 \bar{\ts d}_\dev &= \sum_i^{n_{\mathrm{B}}} \bar{d}_{\dev,i} \ts E_i,\quad  \bar{d}_{\dev,i} = \bar{\ts d}_\dev\dprod \ts E_i
\label{eq:901} \\
 \bar{\ts\sigma}_\dev &= \sum_i^{n_{\mathrm{B}}} \bar{\sigma}_{\dev,i} \ts E_i,\quad \bar{\sigma}_{\dev,i} = \bar{\ts\sigma}_\dev\dprod \ts E_i
\label{eq:902}
\end{align}
%----------------------------------------------------------------------------

\textbf{Remark}: For 3D $n_{\mathrm{B}} = 5$, while for 2D $n_{\mathrm{B}} = 2$.

We are now in the position to compute \emph{sensitivity fields}, corresponding to a unit variation of the macroscale variables $\bar{d}_{\dev,i}$ and $\bar{p}$. First, we shall need to compute the differentials
%----------------------------------------------------------------------------
\begin{align}
    \dif\ta{v}
     = &
    \dif\ta{v}^\macro_\dev + \dif\ta{v}^\macro_\vol + \dif\ta{v}^\fluct.
\label{eq:dv}
\end{align}
%----------------------------------------------------------------------------------
From \eqref{eq:vMdev} and \eqref{eq:901} we obtain
%----------------------------------------------------------------------------
\begin{align}
  \dif \ta{v}^{\macro}_\dev &= \sum_{i} \hat{\ta{v}}^{\macro(i)}_\dev \dif\bar{d}_{\dev,i}, \quad  \hat{\ta{v}}^{\macro(i)}_\dev = \ts E_i \cdot [\ta x - \bar{\ta x}]
\label{eq216}
%\dif\ta{v}^\macro_\vol &= \ta x_\mean \dif \bar{d}_\vol
\end{align}
%----------------------------------------------------------------------------
where $\hat{\ta{v}}^{\macro(i)}_\dev$ are the ``unit velocity fields''.
In analogy with the definition of $\hat{\ta{v}}^{\macro(i)}_\dev$
in \eqref{eq216}, we introduce the ``unit fields'', or sensitivities, due to a unit perturbation of the components $\dif\bar{d}_{\dev,i}$ and of $\dif\bar{p}$, via the \emph{ansatz}
%----------------------------------------------------------------------
\begin{align}
    \dif\ta{v}^\macro_\vol = \ta x_\mean \dif \bar{d}_\vol \quad\mbox{with}\quad
    \dif\bar{d}_\vol &= \sum_i \hat{\bar{d}}_{\vol,\ded}^{(i)}\dif\bar{d}_{\dev,i} + \hat{\bar{d}}_{\vol,\dep} \dif \bar{p}
\\
    \dif\ta v^\fluct &= \sum_i \hat{\ta{v}}_{\ded}^{\fluct(i)}\dif\bar{d}_{\dev,i} + \hat{\ta v}_{\dep}^\fluct \dif \bar{p}
\\
    \dif p           &= \sum_i \hat{p}_{\ded}^{(i)}\dif\bar{d}_{\dev,i} + \hat{p}_{\dep} \dif \bar{p}
\end{align}
%-----------------------------------------------------------------
Upon using the identity $\bar{\ts\sigma}=\frac{1}{\Omega_\Box} \int_{\Gamma_\Box} \ts t \outerp [\ta x - \bar{\ta x}]\dif a$, we deduce the component representation
%---------------------------------------------------------------------------------------
\begin{align}
    \dif\bar{\sigma}_{\dev,i}
    & =
    \dif\bar{\ts\sigma}\dprod \ts E_i
    =
    \dif\left[\frac{1}{\Omega_\Box} \int_{\Gamma_\Box} \ts t \cdot \ts E_i \cdot [\ta x - \bar{\ta x}]\dif a\right]
    =
    -\dif\left[R_\Box^\derv(\bullet;\hat{\ts v}_\dev^{\macro(i)})\right]
\nonumber\\
    &=
    \dif\left[a_\Box(\bullet; \hat{\ta{v}}^{\macro(i)}_\dev)\right] + \dif\left[b_\Box(\bullet; \hat{\ta{v}}^{\macro(i)}_\dev)\right] - \dif\left[l_\Box^\pore(\hat{\ta{v}}^{\macro(i)}_\dev)\right] = (a_\Box)'(\bullet; \hat{\ta{v}}^{\macro(i)}_\dev,\dif\ta{v})
\nonumber \\
    & =
    \sum_j \underbrace{(a_\Box)'(\bullet;\hat{\ta{v}}^{\macro(i)}_\dev,\hat{\ta{v}}^{\macro(j)}_\dev +
    \hat{\ta{v}}^{\fluct(j)}_\ded)}_{\displaystyle \pd{\bar{\sigma}_{\dev,i}}{\bar{d}_{\dev,j}}}
    \dif\bar{d}_{\dev,j}
% Second term
    + \underbrace{(a_\Box)'(\bullet;\hat{\ta{v}}^{\macro(i)}_\dev, \hat{\ta{v}}^{\fluct}_\dep)}_{\displaystyle \pd{\bar{\sigma}_{\dev,i} }{ \bar{p} } }
    \dif\bar{p}.
    \label{eq219}
\end{align}
%---------------------------------------------------------------------------------------
where we used that $b_\Box(\bullet;\hat{\ta v}_\dev^{\macro(i)}) = 0$ and $\dif\left[l_\Box^\pore\right(\hat{\ta v}^{\macro(i)}_\dev)] = 0$. Hence, the (symbolic) tensor format of \eqref{eq219} is obtained from
%---------------------------------------------------------------------------------------
\begin{align}
 \dif\bar{\ts\sigma}_\dev
	&= \sum_i \ts E_i \dif\bar{\sigma}_{\dev,i}
	= \sum_{i,j} \ts E_i \pd{\bar{\sigma}_{\dev,i}}{\bar{d}_{\dev,j}} \dif\bar{d}_{\dev,j} + \sum_i \ts E_i \pd{\bar{\sigma}_{\dev,i}}{\bar{p}}\dif\bar{p}
\nonumber\\
	&= \sum_{i,j} \ts E_i \pd{\bar{\sigma}_{\dev,i}}{\bar{d}_{\dev,j}} [\ts E_j \dprod \dif\bar{\ts d}_{\dev}] + \sum_i \ts E_i \pd{\bar{\sigma}_{\dev,i}}{\bar{p}}\dif\bar{p}
\nonumber\\
    &= \underbrace{\left[\sum_{i,j} \pd{\bar{\sigma}_{\dev,i}}{\bar{d}_{\dev,j}} \ts E_i \outerp \ts E_j\right]}_{\displaystyle\bar{\tf E}_\ded} \dprod \dif\bar{\ts d}_{\dev}
	  + \underbrace{\sum_i \pd{\bar{\sigma}_{\dev,i}}{\bar{p}}}_{\displaystyle\bar{\ts E}_\dep}\ts E_i \dif\bar{p}
\end{align}
%------------------------------------------------------------------------------------
We also obtain trivially the relation
%---------------------------------------------------------------------------------------
\begin{align}
    \dif\bar{d}_\vol
    & = \sum_{i}\hat{\bar{d}}^{(i)}_{\vol,\ded}\dif\bar{d}_{\dev,i} + \hat{\bar{d}}_{\vol,\dep}\dif\bar{p}
      = \underbrace{\left[\sum_{i}\hat{\bar{d}}^{(i)}_{\vol,\ded} \ts E_i\right]}_{\displaystyle\bar{\ts C}_\ded} \dprod\dif\bar{\ts d}_{\dev} + \underbrace{\hat{\bar{d}}_{\vol,\dep}}_{\displaystyle\bar{C}_\dep}\dif\bar{p}
    \label{eq220}
\end{align}
%------------------------------------------------------------------------------------
In order to compute the pertinent sensitivities, we conclude that the state equations \eqref{eq213} must hold
for $\bar{\ts d}_\dev,\bar{p}$ as well as for a perturbed state $\bar{\ts d}_\dev+\dif\bar{\ts d}_\dev, \bar{p}+\dif\bar{p}$.
However, a given change $\dif\bar{\ts d}_\dev$ gives rise to a change, not only of $\dif\ta{v}^\macro_\dev$,
but also of $\dif\ta{v}^\macro_\vol$, $\dif\ta{v}^\fluct\in\set{V}_\Box^{(\Dirichlet)}$ and $\dif p\in\set{P}_\Box$.
Upon linearizing \eqref{eq213}, while using \eqref{eq:dv}, we obtain the appropriate tangent problem:
%----------------------------------------------------------------------------
\begin{subequations}
\begin{alignat}{4}
    &(a_\Box)'(\bullet;\delta\ta{v}^\fluct,\dif\ta{v}^\macro_\dev + \dif\ta{v}^\fluct) +
    b_\Box(\dif p,\delta\ta{v}^\fluct)
    && = 0
    &\quad& \forall\; \delta \ta{v}^\fluct &&\in \set{V}_\Box^{(\Dirichlet)}
 \\
    &b_\Box(\delta p,\dif\ta{v}^\macro_\vol + \dif\ta{v}^\fluct)
    && = 0
    && \forall\; \delta p &&\in \set{P}_\Box
\\
    &b_\Box(\dif p,\ta{x}_\mean)\delta\bar{d}_\vol
    && = \dif\bar{p}\delta\bar{d}_\vol
    && \forall\; \delta\bar{d}_\vol &&\in \set{R}
\end{alignat}
\end{subequations}
%----------------------------------------------------------------------------
%%----------------------------------------------------------------------------
which must hold for any given $\dif\bar{\ts d}_\dev$ and $\dif\bar{p}$. We thus consider the cases ($\dif\bar{\ts d}_\dev\neq \ts{0}, \dif\bar{p}=0$) and ($\dif\bar{\ts d}_\dev=\ts{0}, \dif\bar{p}\neq 0$) in turn:

\begin{enumerate}
\item $\dif\bar{\ts d}_\dev = \ts E_i$ $(\bar{d}_{\dev,i}=1, \bar{d}_{\dev,j}=0$ for $j\neq i)$ while $\dif\bar{p}=0$: For $i=1,\ldots,n_{\mathrm{B}}$, solve for the sensitivities $\hat{\bar{d}}^{(i)}_{\vol,\ded}$, $\hat{\ta{v}}^{\fluct(i)}_\ded$, and $\hat{p}^{(i)}_\ded$ from the system
%----------------------------------------------------------------------------
\begin{subequations}\label{eq233}
\begin{alignat}{4}
    \label{eq233a}
    &(a_\Box)'(\bullet;\delta\ta{v}^\fluct,\hat{\ta{v}}^{\fluct(i)}_\ded) +
      b_\Box(\hat{p}^{(i)}_\ded,\delta\ta{v}^\fluct)
    && = - (a_\Box)'(\bullet;\delta\ta{v}^\fluct,\hat{\ta{v}}^{\macro(i)}_\dev)
    &\quad& \forall\; \delta \ta{v}^\fluct &&\in \set{V}_\Box^{(\Dirichlet)}
 \\
    \label{eq233b}
    &b_\Box(\delta p, \ta x_\mean \hat{\bar{d}}_{\vol,\ded}^{(i)} + \hat{\ta{v}}^{\fluct(i)}_\ded)
    && = 0
    && \forall\; \delta p &&\in \set{P}_\Box
\\
    \label{eq233c}
    &b_\Box(\hat{p}^{(i)}_\ded,\ta{x}_\mean)\delta\bar{d}_\vol
    && = 0
    && \forall\; \delta\bar{d}_\vol &&\in \set{R}
\end{alignat}
\end{subequations}
%----------------------------------------------------------------------------

\item $\dif\bar{p} = 1$ while $\dif\bar{\ts d}_\dev=\ts{0}$: Solve for the sensitivities $\hat{\bar{d}}_{\vol,\dep}$, $\hat{\ta{v}}^{\fluct}_\dep$, and $\hat{p}_\dep$ from the system
%----------------------------------------------------------------------------
\begin{subequations}\label{eq243}
\begin{alignat}{4}
    \label{eq243a}
    &(a_\Box)'(\bullet;\delta\ta{v}^\fluct,\hat{\ta{v}}^{\fluct}_\dep) +
      b_\Box(\hat{p}_\dep,\delta\ta{v}^\fluct)
    && = 0
    &\quad& \forall\; \delta \ta{v}^\fluct &&\in \set{V}_\Box^{(\Dirichlet)}
 \\
    \label{eq243b}
    &b_\Box(\delta p,\ta x_\mean \hat{\bar{d}}_{\vol,\dep}+\hat{\ta{v}}^{\fluct}_\dep)
    && = 0
    && \forall\; \delta p &&\in \set{P}_\Box
\\
    \label{eq243c}
    &b_\Box(\hat{p}_\dep,\ta{x}_\mean)\delta\bar{d}_\vol
    && = 1\delta\bar{d}_\vol
    && \forall\; \delta\bar{d}_\vol &&\in \set{R}
\end{alignat}
\end{subequations}
\end{enumerate}

\section{Numerical example}\label{sec:examples}

The computations were carried out with a linear constitutive model for the viscous flow. Surface tension was considered only on the particle/pore interface. The viscosity $\mu$ and surface energy $\gamma_\surf$ were set to unit values, and the time step was adjusted to obtain sufficiently small deformations in each time step.
%
\begin{figure}[thpb!]
    \centering
    \subfloat[$t = 0$]{\includegraphics[scale=0.14]{figures/evolve_a}\label{fig:evolve_a}}
    \hspace{1em}
    \subfloat[$t = 0.45\; t_{\mathrm{end}}$]{\includegraphics[scale=0.14]{figures/evolve_b}\label{fig:evolve_b}}
    \hspace{1em}
    \subfloat[$t = 0.65\; t_{\mathrm{end}}$]{\includegraphics[scale=0.14]{figures/evolve_c}\label{fig:evolve_c}}
    \hspace{1em}
    \subfloat[$t = t_{\mathrm{end}}$]{\includegraphics[scale=0.14]{figures/evolve_d}\label{fig:evolve_d}}
    \caption{Snapshots of evolving RVE subjected to constant macroscopic shear rate, $\bar{\ts d}_\dev \neq \ts 0$, and zero macroscopic pressure, $\bar{p}=0$.}
    \label{fig:evolve_rve}
\end{figure}
%
\begin{figure}[thpb!]
  \centering
  \begin{tikzpicture}
  \begin{axis}[ yticklabel style={ /pgf/number format/fixed, /pgf/number format/precision=2 },
                tick label style={font=\tiny},font=\footnotesize,
                height=0.2\textheight, width=0.9\textwidth, xmin=0, xmax=1, ymin=-0.5,
                legend style={font=\tiny,at={(1,0)},anchor=south east},
                xlabel={$t_{\mathrm{end}}$}, ylabel={$\bar{d}_\vol$}]
    \addplot[thick,black] table[x=t,y=dvol] {figures/evolve_data.txt};
  \end{axis}
  \end{tikzpicture}
  \caption{Evolution of $\bar{d}_\vol$ with time for the RVE subjected to constant macroscopic shear rate and zero macroscopic pressure.}
  \label{fig:evolve_graph}
\end{figure}

% In \figref{fig:evolve_rve} one can see the new boundary condition which prescribes both a constant macroscopic shear and pressure on the RVE,
% and \figref{fig:evolve_graph} shows that a fully dense RVE was reached at around $0.69 t_{\mathrm{end}}$, at which point all volumetric change stopped, while the constant shear rate was still applied.
% The effect of the Dirichlet boundary condition clearly visible in the sheared state.
% The homogenized shear stress is nearly constant throughout the entire simulation.
% Artifacts from remeshing of the RVE is noticeable in \figref{fig:evolve_graph}, however, the overall macroscopic behavior is mostly unaffected.

A single unit cell (one pore) is subjected to prescribed constant macroscopic shear rate, i.e. $\bar{\ts d}_\dev\neq \ts 0$, whereas the macroscopic pressure is set to zero, $\bar{p}=0$. This situation of ``mixed control'' represents ``quasi-free'' sintering in the sense that the resulting homogenized value of $\bar{\ts\sigma}_\dev$ is non-zero (while $\bar p = 0 $), and it turns out that $\bar{\ts\sigma}_\dev$ stays nearly constant throughout the entire simulation time.
Snapshots of the evolving RVE-configuration are given in \figref{fig:evolve_rve}, and it appears that effects of the adopted Dirichlet boundary condition is clearly visible in the severely sheared state.
The evolution of $\bar d_\vol$, which is a primary variable in the RVE-problem, is shown in \figref{fig:evolve_graph}.
Vanishing porosity, i.e. macroscopic incompressibility manifested by $\bar d_\vol = 0$, was reached at around $0.69\;t_{\mathrm{end}}$.
After this point in time, the deformation continues, but it is completely isochoric.
Artifacts from the remeshing of the RVE are noticeable in \figref{fig:evolve_graph} at early times; however, the overall macroscopic behavior is mostly unaffected.

\section{Conclusions and outlook}\label{sec:conlusions}

By introducing the mixed variational ($\bar{\ts v},\bar{p}$)-format of the macroscale problem, we can ensure a ``seamless'' transition from the macroscopically compressible to the incompressible response. Hence, there is no need to change the computational algorithm when the simulation is taken beyond the state of a fully dense macroscopic response (in some spatial point in the macro-domain). Without such a mixed formulation, the macroscopic ATS-tensor would become unbounded at the transition state. A further advantage of the present formulation is that it allows for more complex constitutive models than the simple isotropic viscous model adopted in this work; one example of added complexity is when $\ts\sigma_\dev$ depends on the intrinsic pressure $p$ in addition to $\ts d_\dev$ (which is the case for anisotropic response due to applied shear rate). In any case we define $\bar{p}$ as the negative mean of $\ts\sigma$.

The additional variable in the RVE-problem, as compared to the standard format of Stokes' problem when $\bar{\ts d}$ is the single variable that represents prolongation from the macroscale to the subscale, is $\bar d_\vol$. An additional constraint equation is added to ensure that the subscale pressure is homogenized to $p$ in a variationally consistent fashion, whereby the test function is $\delta\bar d_\vol\in\set{R}$. Hence, symmetry is preserved of  the linearized RVE-problem due to the variational format of the ``Galerkin-type''. The extra cost for including $\bar d_\vol$ is, indeed, very small in the chosen monolithic format. 

As an outlook to future developments, the new mixed RVE-format will be adopted in conjunction with micro-periodic and Neumann boundary conditions.
It would also be of interest to extend the classical strong format of micro-periodicity to a weak variational setting, cf. Larsson et al. \cite{Larsson_etal2011}.
A major advantage is that the subscale FE-mesh does not need to be periodic, which is particularly beneficial in a context of adaptive mesh (re)generation. 

The microstructural properties of the ``green body'', i.e. before the sintering process starts, should be represented in a more realistic way than is presently the case.
For example, the RVE should be generated from a given statistical distribution of particle size and shape.
Parameter variations should be carried out of the various geometrical and constitutive properties.
In order to make (inverse) parameter identification meaningful, it is necessary to extend the description of the subscale geometry to three dimensions in the future, although this may represent a major increase in complexity and computational demand. 

%With the new formulation with $(\bar{\ts d}_\dev, \bar{p})$-control, the simulation can go beyond a fully dense, macroscopically incompressible, RVE without becoming singular.
%No change in procedure is required when the porosity vanishes.
%In addition to this the mean stress in the RVE is also equal to the macroscopic pressure, which could be required for more complex constitutive behavior in the particles, e.g. $\ts\sigma_\dev(\ts d_\dev,p)$.
%
%The linearized system tangent matrix for the RVE problem gets an additional column and row corresponding to $\bar d_\vol$ and $\delta\bar d_\vol$.
%Worth noting is that the test function in \eqref{eq213c} is chosen as $\ta x_\mean$, so that symmetry is preserved.
%This extra column and row is dense, and with different physical units, but it doesn't cause problems and only brings a negligible computational cost.
%This is due to the fact that a direct solver has to be used to deal with the continuity equation either way.
%
%As future work, the mixed control, $(\bar{\ts d}_\dev, \bar{p})$, should be applied to Neumann and micro periodic boundary conditions as well.

%\clearpage
%\bibliographystyle{plain}
\printbibliography

\appendix
\section{Appendix}
\subsection{RVE-problem}

The weak format of equilibrium for an RVE is
%--------------------------------------------------------------------
\begin{equation}
    \int_{\Omega^\particle_\Box} \ts{\sigma} \dprod \left[\delta \ta{v}\outerp\diff\right]^\sym \dif v =
    \int_{\Gamma_\Box\cup\Gamma_\Box^\pore} \ta{t} \cdot \delta\ta{v} \dif a
\label{eq280}
\end{equation}
%-------------------------------------------------------------------------------
for suitable choice of test functions $\delta \ta{v}$. Testing \eqref{eq280} with $\delta \ta{v}^\fluct$, we directly obtain
%--------------------------------------------------------------------
\begin{equation}
    \int_{\Omega^\particle_\Box} \ts{\sigma} \dprod \left[\delta \ta{v}^\fluct\outerp\diff\right]^\sym \dif v =
    \int_{\Gamma_\Box^\pore} \ta{t}_\surf \cdot \delta\ta{v}^\fluct \dif a
\label{eq281}
\end{equation}
%-------------------------------------------------------------------------------
which is precisely \eqref{eq213a}. Next, testing \eqref{eq280} with $\ta{v}^\macro_\vol(\delta\bar{d}_\vol)$, we obtain
%--------------------------------------------------------------------
\begin{equation}
    - \left[\int_{\Omega^\particle_\Box} p  \dif v \right]\delta\bar{d}_\vol =
    \left[\int_{\Gamma_\Box^\pore} \ta{t}_\surf \cdot \ta{x}_\mean \dif a\right]\delta\bar{d}_\vol =
    - |\Omega_\Box|\bar{p}\,\delta\bar{d}_\vol
\label{eq282}
\end{equation}
%-------------------------------------------------------------------------------
where it was used that $[\ta{x}_\mean\outerp\diff]^\sym=\frac{1}{3}\ts{I}$, $p=-\frac{1}{3}\ts{I}\dprod\ts{\sigma}$ and
%--------------------------------------------------------------------
\begin{equation}
    \bar{p} = - \frac{1}{|\Omega_\Box|} \int_{\Gamma_\Box} \ta{t} \cdot \ta{x}_\mean \dif a =
     - \underbrace{\left[\frac{1}{|\Omega_\Box|} \int_{\Gamma_\Box} \ta{t} \outerp [\ta{x}-\bar{\ta{x}}] \dif a\right]}_{\displaystyle\bar{\ts\sigma}}  \dprod \frac{1}{3}\ts{I}
\end{equation}
%-------------------------------------------------------------------------------
Dividing \eqref{eq282} by $|\Omega_\Box|$, we obtain \eqref{eq213c}.

\subsection{Base dyads in sensitivity problem}

The orthonormal base $\ts E_i$ can be chosen in a cartesian basis, in 2D, as
\begin{align}
 \ts E_1 = \frac{1}{\sqrt{2}}\begin{bmatrix} 1 & 0\\ 0 & -1\end{bmatrix}\quad \ts E_2 = \frac{1}{\sqrt{2}}\begin{bmatrix} 0 & 1\\ 1 & 0\end{bmatrix}
\end{align}
and in 3D, as
\begin{align}
 &\ts E_1 = \frac{1}{\sqrt{6}}\begin{bmatrix} 2 & 0 & 0\\ 0 & -1 & 0\\ 0 & 0 & -1\end{bmatrix}
 &&\ts E_2 = \frac{1}{\sqrt{2}}\begin{bmatrix} 0 & 0 & 0\\ 0 & 1 & 0 \\ 0 & 0 & -1\end{bmatrix}
 &&\\
 &\ts E_3 = \frac{1}{\sqrt{2}}\begin{bmatrix} 0 & 1 & 0\\ 1 & 0 & 0 \\ 0 & 0 & 0\end{bmatrix}
 &&\ts E_4 = \frac{1}{\sqrt{2}}\begin{bmatrix} 0 & 0 & 1\\ 0 & 0 & 0 \\ 1 & 0 & 0\end{bmatrix}
 &&\ts E_5 = \frac{1}{\sqrt{2}}\begin{bmatrix} 0 & 0 & 0\\ 0 & 0 & 1 \\ 0 & 1 & 0\end{bmatrix}
\end{align}


\end{document}

